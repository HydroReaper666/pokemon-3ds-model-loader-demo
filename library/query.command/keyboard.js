$(function(){var e={"u+0008":["backspace"],"u+0009":["tab"],"u+0018":["cancel"],"u+001b":["escape"],"u+0020":["space"],"u+002b":["plus"],"u+002d":["minus"],"u+005f":["underscore"],enter:["return","enter"],meta:["meta","command"]},n={8:"backspace",9:"tab",13:"enter",16:"shift",17:"control",18:["alt","option"],19:["pause","break"],20:"caps_lock",27:"escape",32:"space",33:"page_up",34:"page_down",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:["meta","left_meta","command","left_command","windows","left_windows"],92:["meta","right_meta","command","right_command","windows","right_windows"],93:["select"],96:["0","numpad_0"],97:["1","numpad_1"],98:["2","numpad_2"],99:["3","numpad_3"],100:["4","numpad_4"],101:["5","numpad_5"],102:["6","numpad_6"],103:["7","numpad_7"],104:["8","numpad_8"],105:["9","numpad_9"],106:["*","numpad_*"],107:["plus","numpad_plus"],109:["minus","numpad_minus"],110:[".","numpad_."],111:["/","numpad_/"],144:"number_lock",145:"scroll_lock",186:";",187:"=",188:",",189:"minus",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},t=null,r=null,a=null,o=null,i=0,s=[];$.command.register("body","keyboard:hit",function(c,u){if(!u.compositing){var m=c.parameters[0].which,l=c.parameters[0].key,p=c.parameters[0].location;93===m&&"meta"===l.toLowerCase()&&(p="right");var d=[];n.hasOwnProperty(m)&&($.is(n[m],Array)?d=n[m].slice(0):d.push(n[m]));var h=l.toLowerCase();e.hasOwnProperty(h)?e[h].forEach(function(e){-1===d.indexOf(e)&&d.push(e)}):(/^u\+/.test(h)&&(h=String.fromCharCode(parseInt(h.substring(2),16)).toLowerCase()),-1===d.indexOf(h)&&d.push(h));var g=function(e){d.slice(0).forEach(function(n){0!==n.indexOf(e)&&-1===d.indexOf(e+n)&&d.push(e+n)})};switch(p){case"left":g("left_");break;case"right":g("right_");break;case"numpad":g("numpad_")}var b=[];if(-1!==d.indexOf("meta")?o=d:-1!==d.indexOf("control")?t=d:-1!==d.indexOf("alt")?r=d:-1!==d.indexOf("shift")?a=d:(c.parameters[0].meta&&b.push(o),c.parameters[0].control&&b.push(t),c.parameters[0].alt&&b.push(r),c.parameters[0].shift&&b.push(a)),b.push(d),!i||Date.now()-i>1e3)s=[],i=Date.now();else if(s.length>0)for(var v=s[s.length-1];s.length>0&&1===v.length&&(-1!==v[0].indexOf("meta")||-1!==v[0].indexOf("control")||-1!==v[0].indexOf("alt")||-1!==v[0].indexOf("shift"));)s.pop(),v=s[s.length-1];s.push(b),f(c.target,s)&&(s=[],c.preventDefault())}});var c={},u=[],m={},f=function(e,n){for(var t=0,r=[],a=[c],o=n.length;o>0;){var i=[];n[--o].forEach(function(e){e.forEach(function(e){-1===i.indexOf(e)&&i.push(e)})});var s=[];a.forEach(function(n){var a=0;Object.keys(n).filter(function(e){if("!"===e[0])return!1;var t=n[e]["!combinations"].filter(function(e){return-1!==i.indexOf(e)}).length===n[e]["!combinations"].length;return t&&(a=Math.max(a,n[e]["!combinations"].length)),t}).filter(function(e){return n[e]["!combinations"].length===a}).forEach(function(a){s.push(n[a]),Object.keys(n[a]["!selectors"]).filter(function(n){return $.dom.matchSelector.super(e,n)}).forEach(function(e){n[a]["!selectors"][e].forEach(function(e){r.push(e),t=Math.max(t,e.combinationsSequence.length)})})})}),a=s}r=r.filter(function(e){return e.combinationsSequence.length===t});var u=$.dom.filterSelectors(e,r.map(function(e){return e.selector}));if(u.length>0){r=r.sort(function(e,n){var t=u.indexOf(e.selector),r=u.indexOf(n.selector);return t<r?-1:t>r?1:0});for(var m=!1,o=0;o<r.length&&!m;)l(r[o].keyboardID,"keyboard"),m=$.command.dispatch(e,r[o].command,r[o].parametersGenerator(r[o].command,e)),++o;return m}return!1},l=function(e,n){var t=$.uuid();m[e].lastFireRecord={version:t,time:Date.now(),activator:n},process.nextTick(function(){t===m[e].lastFireRecord.version&&(m[e].lastFireRecord.time=Date.now())})};$.command.keyboard={register:function(e,n,t,r){$.is(n,String)&&(n=n.split(/\s+/)),n=n.map(function(e){$.is(e,String)&&(e=e.split("-"));var n=["meta","command","windows","control","alt","option","shift","select"];return e=e.map(function(e){return e.trim()}).sort(function(e,t){var r=n.indexOf(e),a=n.indexOf(t);return-1===r&&(r=n.length),-1===a&&(a=n.length),r<a?-1:r>a?1:e.localCompare(t)})});for(var a=c,o=n.length;o>0;){var i=n[--o],s=i.join("-");a.hasOwnProperty(s)||(a[s]={"!combinations":i,"!selectors":{}}),a=a[s]}$.is(r,Function)||(r=function(e){$.is.nil(e)?e=[]:$.is(e,Array)||(e=[e]);var n=function(){return e};return n.staticParameters=e,n}(r));var f=$.uuid();a["!selectors"].hasOwnProperty(e)||(a["!selectors"][e]=[]),u.hasOwnProperty(t)||(u[t]={}),u[t].hasOwnProperty(e)||(u[t][e]=[]);var l={keyboardID:f,combinationsSequence:n,selector:e,command:t,parametersGenerator:r};a["!selectors"][e].push(l),u[t][e].push(l),m[f]=l},lookup:function(e){var n=[];return u.hasOwnProperty(e)&&Object.keys(u[e]).forEach(function(t){u[e][t].forEach(function(e){n.push({keyboardID:e.keyboardID,selector:t,combinationsSequence:e.combinationsSequence,keys:e.combinationsSequence.map(function(e){return e.join("-")}).join(" "),parametersGenerator:e.parametersGenerator})})}),n},record:l,justFired:function(e){return!!m[e]&&m[e].lastFireRecord&&Date.now()-m[e].lastFireRecord.time<1e3}}});