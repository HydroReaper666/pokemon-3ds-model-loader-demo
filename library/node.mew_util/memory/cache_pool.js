var CachePool=function(e,t){var i=this;Object.defineProperty(this,"timeout",{writable:!0,value:parseInt(e)}),isNaN(this.timeout)&&(this.timeout=12e5);try{Object.defineProperty(this,"pool",{enumerable:!1,value:new Map})}catch(e){this.pool=new Map}Object.defineProperty(this,"delegate",{value:{willReleaseContent:function(){},didClearExpired:function(){}}}),t&&Object.keys(t).forEach(function(e){"function"==typeof t[e]&&(i.delegate[e]=t[e])})},define=function(e,t){try{Object.defineProperty(CachePool.prototype,e,{enumerable:!1,value:t})}catch(i){CachePool.prototype[e]=t}};define("has",function(e){return this.pool.has(e)}),CachePool.prototype.working=!0;try{Object.defineProperty(CachePool.prototype,"count",{enumerable:!0,get:function(){return this.pool.size}})}catch(e){}define("keys",function(){for(var e=[],t=this.pool.keys(),i=t.next();!i.done;)e.push(i.value),i=t.next();return e}),define("get",function(e,t,i,o,n){if(this.pool.has(e)){var r=this.pool.get(e);return t&&this.refresh(e,o),r.content}if(i){var s=i();return this.pool.set(e,{content:s,listener:n}),this.refresh(e,o),s}return null}),define("fetch",function(e){return this.keys().filter(function(t){return!e||e(t,this.pool.get(t).content)}.bind(this)).map(function(e){return{id:e,content:this.pool.get(e).content}}.bind(this))}),define("put",function(e,t,i){if(this.pool.has(e)){var o=this.pool.get(e);i||(i=o.timeout),o.content=t,o.timeout=i,o.expiredDate=(new Date).getTime()+i}else i||(i=this.timeout),this.pool.set(e,{content:t,timeout:i,expiredDate:(new Date).getTime()+i});this.refresh(e)}),define("refresh",function(e,t){if(this.pool.has(e)){var i=this.pool.get(e);t||(t=i.timeout),t||(t=this.timeout),i.timeout=t,i.expiredDate=(new Date).getTime()+t}}),define("clearExpired",function(e){var t=(new Date).getTime(),i=0;this.keys().slice(0).forEach(function(o){var n=this.pool.get(o);n.expiredDate<t&&(this.delegate.willReleaseContent.call(this,o,n.content),n.listener&&n.listener(n.content),i+=1,this.pool.delete(o),e&&e(n.expiredDate,n.content))}.bind(this)),this.delegate.didClearExpired.call(this,i)}),define("remove",function(e){return!!this.pool.has(e)&&this.pool.delete(e)}),module.exports=CachePool;