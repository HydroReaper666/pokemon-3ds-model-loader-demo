var os=require("os"),path=require("path"),foundation=require("./foundation.js"),home=require("./home.js");if("js"!==process.arch)var task=require("./task.js");home.registerUtilConfig("logger",{"!noLogger":!0,logLevel:{"!valueType":"string","!defaultValue":"info"},logStyle:{"!valueType":"string","!defaultValue":process.isEmbedded||-1!==["android","ios"].indexOf(process.platform)||global.window&&global.window.navigator?"none":"darwin"===os.type().toLowerCase()?"bright":"dark"},supportMultipleLine:{"!valueType":"boolean","!defaultValue":"android"!==process.platform},autorecordFileLine:{"!valueType":"boolean","!defaultValue":!0},prefix:{"!valueType":"string","!defaultValue":""}});var styleCodePoints={white:[37,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39],brightBlack:[90,39],brightRed:[91,39],brightGreen:[92,39],brightYellow:[93,39],brightBlue:[94,39],brightMagenta:[95,39],brightCyan:[96,39],brightWhite:[97,39],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},logLevelMap={system:1,assert:2,error:3,dump:4,warn:5,celebr:6,info:7,debug:8},logLevelDisplayMap={system:"[system]",assert:"[assert]",error:" [error]",warn:"  [warn]",info:"  [info]",celebr:"[celebr]",debug:" [debug]",dump:"  [dump]"},styles={bright:{system:["brightMagenta","bold"],assert:["magenta"],error:["red","bold"],warn:["yellow","bold"],celebr:["cyan","bold"],info:["black"],debug:["brightBlack"],dump:["blue","bold"],line:["white"]},dark:{system:["magenta"],assert:["brightMagenta","bold"],error:["brightRed","bold"],warn:["brightYellow","bold"],celebr:["brightGreen","bold"],info:["brightWhite"],debug:["white"],dump:["brightCyan"],line:["brightBlack"]}},logPlaceholder=null,Logger=function(e){e=home.getUtilConfigSync("logger",null,e),this.logLevel=e.logLevel,this.prefix=e.prefix,["logStyle","supportMultipleLine","autorecordFileLine"].forEach(function(o){try{Object.defineProperty(this,o,{enumerable:!1,value:e[o]})}catch(l){this[o]=e[o]}}.bind(this))},LoggerFileLine=function(e){this.fileLine=e},LoggerOffset=function(e){this.offset=e};Logger.fileLine=function(e){return new LoggerFileLine(e)},Logger.offset=function(e){return new LoggerOffset(e)};var logWithLevel=function(e,o){if(e=e.replace(/\.[a-z0-9A-Z\-_]+\.mew\-js($|:)/,function(e){return-1!==["/","\\",":"].indexOf(e[e.length-1])?".js"+e[e.length-1]:".js"}),e=e.replace(/\.[a-z0-9A-Z\-_]+\.mew\-chan([\\\/:]|^)/,function(e){return-1!==["/","\\",":"].indexOf(e[e.length-1])?".chan"+e[e.length-1]:".chan"}),logLevelMap[this.logLevel]>=logLevelMap[o]){var l=!1;if(this.handler)try{l=this.handler.apply(this,arguments)}catch(e){}l||this.logInConsole.apply(this,arguments)}if(logLevelMap[o]<=logLevelMap.assert)throw new Error(arguments[2])};try{Object.defineProperty(Logger.prototype,"logWithLevel",{enumerable:!1,value:logWithLevel})}catch(e){Logger.prototype.logWithLevel=logWithLevel}var logInConsole=function(e,o,l){var t=foundation.formatDate(new Date,"MM-DD hh:mm:ss.SSS",!0)+" "+logLevelDisplayMap[o].toUpperCase()+" ";logPlaceholder||(logPlaceholder=t.replace(/./g,function(){return" "})),this.prefix&&(t+=this.prefix);var l=arguments[2];arguments.length>3&&(l=foundation.copyAsArray(arguments).slice(2).join(", "));var r=null;if(r=null===l?"null":void 0===l?"undefined":l instanceof Error?l.message+"\n"+foundation.getStack(l):l.constructor===Buffer?l.toString():l.constructor!==String?foundation.jsonize(l):l,r=r.split("\n").map(function(e,o){return o>0?this.supportMultipleLine?logPlaceholder+e:e:t+e}.bind(this)).join("\n"),this.autorecordFileLine&&(e="("+e+")"),styles[this.logStyle]){var n=styles[this.logStyle][o];n&&n.forEach(function(e){if(styleCodePoints[e]){var o="["+styleCodePoints[e][0]+"m",l="["+styleCodePoints[e][1]+"m";r=o+r+l}});var i=styles[this.logStyle].line;i&&i.forEach(function(o){if(styleCodePoints[o]){var l="["+styleCodePoints[o][0]+"m",t="["+styleCodePoints[o][1]+"m";e=l+e+t}})}this.output(o,r,this.autorecordFileLine?e:null)};try{Object.defineProperty(Logger.prototype,"logInConsole",{enumerable:!1,value:logInConsole})}catch(e){Logger.prototype.logInConsole=logInConsole}Object.keys(logLevelMap).forEach(function(e){var o=function(){var o=Array.prototype.slice.call(arguments,0),l=null;l=foundation.isKindOf(o[0],LoggerOffset)?home.getFileLine(o.shift().offset+1,4):foundation.isKindOf(o[0],LoggerFileLine)?o.shift().fileLine:home.getFileLine(1,4),o.unshift(e),o.unshift(l),this.logWithLevel.apply(this,o)};try{Object.defineProperty(Logger.prototype,e,{enumerable:!1,configurable:!0,writable:!0,value:o})}catch(l){Logger.prototype[e]=o}}.bind(this));var assert=function(){var e=null,o=null,l=null;foundation.isKindOf(arguments[0],LoggerOffset)?(o=home.getFileLine(arguments[0].offset+1,4),e=arguments[1],l=Array.prototype.slice.call(arguments,2)):foundation.isKindOf(arguments[0],LoggerFileLine)?(o=arguments[0].fileLine,e=arguments[1],l=Array.prototype.slice.call(arguments,2)):(o=home.getFileLine(1,4),e=arguments[0],l=Array.prototype.slice.call(arguments,1)),e||(l.unshift("assert"),l.unshift(o),this.logWithLevel.apply(this,l))};try{Object.defineProperty(Logger.prototype,"assert",{enumerable:!1,value:assert})}catch(e){Logger.prototype.assert=assert}var dump=function(){var e=null,o=3,l=null;foundation.isKindOf(arguments[0],LoggerOffset)?(l=home.getFileLine(arguments[0].offset+1,4),e=arguments[1],o=arguments[2]):foundation.isKindOf(arguments[0],LoggerFileLine)?(l=arguments[0].fileLine,e=arguments[1],o=arguments[2]):(l=home.getFileLine(1,4),e=arguments[0],o=arguments[1]),o||(o=3),this.prefix||!this.supportMultipleLine?this.logWithLevel.call(this,l,"dump","\n"+foundation.jsonize(e,"",o)):this.logWithLevel.call(this,l,"dump",foundation.jsonize(e,"",o))};try{Object.defineProperty(Logger.prototype,"dump",{enumerable:!1,value:dump})}catch(e){Logger.prototype.dump=dump}var clearScreen=function(e){if(!global.window||!global.window.navigator)if(e)this.output("[2J");else{for(var o=task.getTermSize().rows;o>0;)this.output(""),--o;this.output("[1;1H")}};try{Object.defineProperty(Logger.prototype,"clearScreen",{enumerable:!1,value:clearScreen})}catch(e){Logger.prototype.clearScreen=clearScreen}var output=function(){if(1===arguments.length)console.log(arguments[0]);else switch(arguments[0]){case"system":case"assert":case"error":{let e=arguments[1];if(!(e instanceof Error)&&e.message&&e.stack){let o=new Error(e.message);o.stack=e.stack,e=o}global.window?arguments[2]?console.log("%c%s %c%s","color: #f00",e,"color: #bbb;",arguments[2]):console.log("%c%s","color: #f00",e):arguments[2]?console.error(e+" "+arguments[2]):console.error(e);break}case"dump":global.window?arguments[2]?console.log("%c%s %c%s","color: #22c",arguments[1],"color: #bbb;",arguments[2]):console.log("%c%s","color: #22c",arguments[1]):arguments[2]?console.warn(arguments[1]+" "+arguments[2]):console.warn(arguments[1]);break;case"warn":global.window?arguments[2]?console.log("%c%s %c%s","color: #850",arguments[1],"color: #bbb;",arguments[2]):console.log("%c%s","color: #850",arguments[1]):arguments[2]?console.warn(arguments[1]+" "+arguments[2]):console.warn(arguments[1]);break;case"celebr":global.window?arguments[2]?console.log("%c%s %c%s","color: #0a9",arguments[1],"color: #bbb;",arguments[2]):console.log("%c%s","color: #0a9",arguments[1]):console.celebr?arguments[2]?console.celebr(arguments[1]+" "+arguments[2]):console.celebr(arguments[1]):arguments[2]?console.info(arguments[1]+" "+arguments[2]):console.info(arguments[1]);break;case"info":global.window?arguments[2]?console.log("%c%s %c%s","color: #000",arguments[1],"color: #bbb;",arguments[2]):console.log("%c%s","color: #000",arguments[1]):arguments[2]?console.info(arguments[1]+" "+arguments[2]):console.info(arguments[1]);break;case"debug":default:global.window?arguments[2]?console.log("%c%s %c%s","color: #888",arguments[1],"color: #bbb;",arguments[2]):console.log("%c%s","color: #888",arguments[1]):console.debug?arguments[2]?console.debug(arguments[1]+" "+arguments[2]):console.debug(arguments[1]):arguments[2]?console.info(arguments[1]+" "+arguments[2]):console.info(arguments[1])}};try{Object.defineProperty(Logger.prototype,"output",{enumerable:!1,value:output})}catch(e){Logger.prototype.output=output}Logger.default=new Logger,module.exports=Logger;