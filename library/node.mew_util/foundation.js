var comparator=require("./comparator.js"),template=require("./template.js"),uuid=require("./uuid.js"),Logger=null,Buffer=global.Buffer;Buffer||(Buffer=function(){},global.Buffer=Buffer);var accelerated=null,isAccelerated=function(){return null===accelerated&&global.$&&global.$["!space"]&&(accelerated="yes"===global.$["!space"]("query").meta("query","accelerate")),accelerated},Symbol=global.Symbol;Symbol||((Symbol=function e(){if(!(this instanceof e))return new e;this.key=uuid.createUUID()}).prototype.toString=function(){return this.key},global.Symbol=Symbol);var Logger=null,deprecated=function(e,r,t){var n=!1;return function(){return n||(n=!0,Logger||(Logger=require("./logger.js")),Logger.default.warn(Logger.offset(1),"Function "+e+" is deprecated, please use "+r)),t.apply(this,arguments)}},getScriptEngineName=function(){return Object.prototype.toSource&&Object.prototype.watch&&Object.prototype.unwatch?"SM":"V8"},objectize=function(e){return isNull(e)&&(e={}),function(){return this}.bind(e)()},isNull=function(e){return null===e||void 0===e},isKindOf=function(e,r){if(isNull(e))return!1;switch(typeof e){case"boolean":return r===Boolean;case"number":return r===Number;case"string":return r===String;case"function":return r===Function||e instanceof r;case"symbol":return r===Symbol;case"undefined":return!1;case"object":default:return e instanceof r}},simplify=function(e){if(isAccelerated())return e;if(isNull(e))return null;switch(typeof e){case"boolean":case"number":case"string":case"function":case"symbol":return e;case"undefined":return!1;case"object":default:return e instanceof Boolean?e&&!0:e instanceof Number?e+0:e instanceof String?e+"":e}},prepadZero=function(e,r){for(e+="";e.length<r;)e="0"+e;return e},jsonizeHandlers=new Map,jsonizeIndentUnit="    ",jsonizeMaximumLevel=3,jsonize=function(e,r,t){t=parseInt(t),isFinite(t)||(t=jsonizeMaximumLevel);var n=jsonize.prototype(e);if(null===e)return"null";if(void 0===e)return"undefined";if(jsonizeHandlers.has(n))return jsonizeHandlers.get(n)(e,r,t);if(isKindOf(e,Boolean))return e?"true":"false";if(isKindOf(e,Number))return e+"";if(isKindOf(e,Symbol))return'Symbol("'+e.toString().slice("Symbol(".length,-1).replace(/\\/gim,"\\\\").replace(/\n/gim,"\\n").replace(/\r/gim,"\\r").replace(/"/gim,'\\"')+'")';if(isKindOf(e,String))return'"'+e.replace(/\\/gim,"\\\\").replace(/\n/gim,"\\n").replace(/\r/gim,"\\r").replace(/"/gim,'\\"')+'"';if(isKindOf(e,RegExp))return"/"+e.source+"/"+(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"");if(isKindOf(e,Function))return e.name&&isKindOf(e.name,String)?"function "+e.name+"() { /* code */ }":"function () { /* code */ }";if(isKindOf(e,Buffer)){var i=Array.prototype.map.call(e.slice(0,8),function(e,r){return"0x"+e.toString(16)}).join(", ");return e.length<8?"Buffer.from( /* "+e.length+" bytes */ ["+i+"])":"Buffer.from( /* "+e.length+" bytes ... */ ["+i+"])"}if(isKindOf(e,Date))return'new Date("'+formatDate(e)+'")';if(isKindOf(e,Error)){r=r||"";var a=getStack(e);return a=a?a.split("\n").map(function(e){return r+e}).join("\n")+"\n":"","new "+e.name+'("'+e.message.replace(/\\/gim,"\\\\").replace(/\n/gim,"\\n").replace(/\r/gim,"\\r").replace(/"/gim,'\\"')+'") /*\n'+a+r+"*/"}if(isKindOf(e,Array)){if(e.length>0){if(r&&r.length/jsonizeIndentUnit.length>=t)return"[ /* "+e.length+" items ... */ ]";for(var u=(r||"")+jsonizeIndentUnit,s={},l={},o=["["],c=0;c<e.length;){var f=e[c];o.push(s),o.push(jsonize(f,u,t)),c<e.length-1&&o.push(", "),o.push(l),++c}var p=0,d=!1;return o.forEach(function(e){/[\r\n]/.test(e)&&(d=!0),e!==s&&e!==l&&(p+=e.length)}),p+r>60||d?(o.splice(1,0," ","/* ",e.length," ","items"," */","\n"),o=o.map(function(e){return e===s?u:e===l?"\n":e}),r&&o.push(r)):(o.splice(1,0," "),(o=o.map(function(e){return e===s?"":e===l?"":e})).push(" ")),o.push("]"),o.join("")}return"[]"}var g=[],m=[],h=Object.keys(e);for(var y in e)-1===h.indexOf(y)&&h.push(y);h.forEach(function(r){isKindOf(e[r],Function)?-1===m.indexOf(r)&&m.push(r):-1===g.indexOf(r)&&void 0!==e[r]&&g.push(r)}),g=g.sort(comparator.insensitiveNaturalComparator),m=m.sort(comparator.insensitiveNaturalComparator);var O=Object.getPrototypeOf(e),b="";if(O&&O.constructor){if(b=O.constructor.name)try{b="/* "+b}catch(e){b=""}else b="";O.constructor===Object&&(b="")}if(g.length>0||m.length>0){if(r&&r.length/jsonizeIndentUnit.length>=t)return b?"{ "+b+" ... */ }":"{ /* ... */ }";o=null;o=b?["{ "+b+" */ "]:["{ "];var s={},l={},u=(r||"")+jsonizeIndentUnit;g.forEach(function(r,n){o.push(s),o.push(jsonize(r)),o.push(": "),o.push(jsonize(e[r],u,t)),(n<g.length-1||m.length>0)&&o.push(", "),o.push(l)}),g.length+m.length<20&&m.forEach(function(r,n){o.push(s),o.push(jsonize(r)),o.push(": "),o.push(jsonize(e[r],u,t)),n<m.length-1&&o.push(", "),o.push(l)});var p=0,d=!1;return o.forEach(function(e){/[\r\n]/.test(e)&&(d=!0),e!==s&&e!==l&&(p+=e.length)}),p+r>60||d?((o=o.map(function(e){return e===s?u:e===l?"\n":e})).splice(1,0,"\n"),r&&o.push(r)):(o=o.map(function(e){return e===s?"":e===l?"":e})).push(" "),o.push("}"),o.join("")}return b?"{ "+b+" */ }":"{}"};jsonize.register=function(e,r){jsonizeHandlers.set(e,r)},jsonize.prototype=function(e){return e?Object.getPrototypeOf(e):null};var isArrayLike=function(e,r){return!isNull(e)&&(!!Array.isArray(e)||(e.constructor===String?!!r:isFinite(parseInt(e.length))))},iterateArray=function(e,r){isArrayLike(e)&&Array.prototype.forEach.call(e,r)},iterate=function(e,r){isArrayLike(e)?Array.prototype.forEach.call(array,r):iterateObject(e,r)},copyAsArray=function(e){if(!isArrayLike(e))return[];try{return Array.prototype.slice.call(e,0)}catch(e){for(var r=[],t=0;t<this.length;)r[t]=this[t],++t;return r}},formatDate=function(e,r,t){var n=function(e,r){for(e+="";e.length<r;)e="0"+e;return e};e||(e=new Date),r||(r="YYYY-MM-DD hh:mm:ss.SSS");for(var i=[],a=0;a<r.length;)switch(r[a]){case"Y":"Y"==r[a+1]?"Y"==r[a+2]&&"Y"==r[a+3]?(i.push(n(t?e.getUTCFullYear():e.getFullYear(),4)),a+=4):(i.push(n((t?e.getUTCFullYear():e.getFullYear())%100,2)),a+=2):(i.push((t?e.getUTCFullYear():e.getFullYear())+""),++a);break;case"M":"M"==r[a+1]?(i.push(n((t?e.getUTCMonth():e.getMonth())+1,2)),a+=2):(i.push((t?e.getUTCMonth():e.getMonth())+1+""),++a);break;case"D":"D"==r[a+1]?(i.push(n(t?e.getUTCDate():e.getDate(),2)),a+=2):(i.push((t?e.getUTCDate():e.getDate())+""),++a);break;case"h":"h"==r[a+1]?(i.push(n(t?e.getUTCHours():e.getHours(),2)),a+=2):(i.push((t?e.getUTCHours():e.getHours())+""),++a);break;case"m":"m"==r[a+1]?(i.push(n(t?e.getUTCMinutes():e.getMinutes(),2)),a+=2):(i.push((t?e.getUTCMinutes():e.getMinutes())+""),++a);break;case"s":"s"==r[a+1]?(i.push(n(t?e.getUTCSeconds():e.getSeconds(),2)),a+=2):(i.push((t?e.getUTCSeconds():e.getSeconds())+""),++a);break;case"S":"S"==r[a+1]&&"S"==r[a+2]?(i.push(n(t?e.getUTCMilliseconds():e.getMilliseconds(),3)),a+=3):(i.push((t?e.getUTCMilliseconds():e.getMilliseconds())+""),++a);break;case'"':case"'":for(var u=1;r[a+u]!=r[a]&&a+u<r.length;)"\\"==r[a+u]?(i.push(r[a+u+1]),u+=2):(i.push(r[a+u]),++u);a+=u+1;break;default:i.push(r[a]),++a}return i.join("")},iterateObject=function(e){if(!(isNull(e)||isKindOf(e,Boolean)||isKindOf(e,Number)||isKindOf(e,String)||isKindOf(e,Date)||isKindOf(e,RegExp))){var r=!1;3===arguments.length&&(r=!!arguments[1]);var t=arguments[arguments.length-1];Object.keys(e).slice(0).forEach(function(n){(e.hasOwnProperty(n)||r)&&t(n,e[n])})}},couldBeAcceptedAs=function(e,r){switch(r&&0===r.indexOf("regex-source-")&&(r.split("-")[2],r="regex-source"),r){case"boolean":return isKindOf(e,Boolean);case"number":return isKindOf(e,Number);case"string":return isKindOf(e,String);case"buffer":return isKindOf(e,Buffer);case"date":return isKindOf(e,Date);case"regex":return isKindOf(e,RegExp);case"function":return isKindOf(e,Function);case"array":return isKindOf(e,Array);case"array-like":return isArrayLike(e);case"object":return!(isNull(e)||isKindOf(e,Boolean)||isKindOf(e,Number)||isKindOf(e,String)||isKindOf(e,RegExp)||isKindOf(e,Date)||isKindOf(e,Function));case"any":return!0;default:return!!isKindOf(r,Function)&&!!isKindOf(e,r)}},getStack=function(e){var r=null;try{switch(e?(r=e.stack.split("\n"),"V8"===getScriptEngineName()&&(r=r.slice(1))):(r=new Error("Get stack").stack.split("\n"),r="V8"===getScriptEngineName()?r.slice(2):r.slice(1)),getScriptEngineName()){case"SM":return"    at "!==r[0].substring(0,7)?r.join("\n").trim().split("\n").map(function(e){var r=e.split("@");return r[0].trim().length>0?"    at "+r[0]+" ("+r.slice(1).join("@")+")":"    at Object.<anonymous> ("+r.slice(1).join("@")+")"}).join("\n"):r.join("\n");case"V8":default:return r.join("\n")}}catch(e){}return null},convert=function(e,r,t){var n="m";r&&0===r.indexOf("regex-source-")&&(n=r.split("-")[2],r="regex-source");var i=function(e){if(t&&t.validator){if(template.execute(t.validator,{data:e},{functors:{isArrayLike:function(e,r,t,n,i){return isArrayLike(i)},enum:function(e,r,t,n){return-1!==Array.prototype.slice.call(arguments,4).indexOf(t.data)},range:function(e,r,t,n,i,a,u,s){return t.data>=i&&t.data<=a&&((!u||t.data!==i)&&(!s||t.data!==a))},notNull:function(e,r,t,n){return null!==t.data&&void 0!==t.data},notEmpty:function(e,r,t,n){return isKindOf(t.data,String)?t.data.trim().length>0:isKindOf(t.data,Array)?t.data.length>0:isArrayLike(t.data)?t.data.length>0:null!==t.data&&void 0!==t.data}}}))return e;if(t.hasOwnProperty("failedValue"))return t.failedValue;throw new Error("Invalid value: "+e)}return e};switch(r){case"boolean":return i(isNull(e)&&t?!!t.defaultValue:!!e);case"number":var a=NaN;a=t&&t.numberAsInteger?parseInt(e):parseFloat(e);return(t&&t.numberShouldFinite?!isFinite(a):isNaN(a))&&(t&&t.numberAsInteger?a=parseInt(t.defaultValue):t&&(a=parseFloat(t.defaultValue))),i(a);case"string":if(isKindOf(e,Date))return i(formatDate(e,"YYYY-MM-DDThh:mm:ss.SSSZ",!0));if(isArrayLike(e)&&t&&t.stringDelimiter)return i(copyAsArray(e).join(t.stringDelimiter));return isNull(e)||(o=t&&t.autotrim?(""+e).trim():""+e),t&&t.emptyAsNull&&0===o.length&&(o=null),isNull(o)&&t&&!isNull(t.defaultValue)&&(o=""+t.defaultValue),i(o);case"buffer":return isKindOf(e,String)?i(new Buffer(e,"utf8")):isKindOf(e,Buffer)?i(e):(e=t.defaultValue,isKindOf(e,String)?i(new Buffer(e,"utf8")):isKindOf(e,Buffer)?i(e):null);case"date":return i(isKindOf(e,String)?/^(\-?)[0-9]+$/.test(e)?new Date(parseInt(e)):new Date(e):isKindOf(e,Number)?new Date(e):isKindOf(e,Date)?e:t?isNull(t.defaultValue)?null:t.defaultValue:null);case"regex":case"regex-ignore-case":return isNull(e)&&t&&(e=t.defaultValue),isKindOf(e,RegExp)?i(e):isNull(e)?i(null):((u=new RegExp("^"+(e+"").replace(/[\$\^\*\(\)\-\+\[\]\{\}\\\|\,\?\/\.]/g,function(e){return"\\"+e})+"$","m")).fromString=e,i(u));case"regex-asterisk":return isNull(e)&&t&&(e=t.defaultValue),isKindOf(e,RegExp)?i(e):isNull(e)?i(null):((u=new RegExp("^"+(e+"").replace(/[\$\^\(\)\-\+\[\]\{\}\\\|\,\?\/\.]/g,function(e){return"\\"+e}).replace(/\*/g,".*")+"$","m")).fromString=e,i(u));case"regex-asterisk-dot":return isNull(e)&&t&&(e=t.defaultValue),isKindOf(e,RegExp)?i(e):isNull(e)?i(null):((u=new RegExp("^"+(e+"").replace(/[\$\^\(\)\-\+\[\]\{\}\\\|\,\?\/\.]/g,function(e){return"\\"+e}).replace(/(\\\.)*(\*+)(\\\.)*/g,function(e){return"\\."===e.slice(0,2)?"\\."===e.slice(-2)?"(\\.|\\..+\\.)":"(\\..+)?":"\\."===e.slice(-2)?"(.+\\.)?":".*"})+"$","m")).fromString=e,i(u));case"regex-path":return isNull(e)&&t&&(e=t.defaultValue),isKindOf(e,RegExp)?i(e):isNull(e)?i(null):((u=new RegExp("^"+(e+"").replace(/[\\\/]+$/,"").replace(/((^|[^\\\/])[\\\/]([^\\\/]|$))|([\$\^\(\)\-\+\[\]\{\}\|\,\\\/\.])/g,function(e){return e.length>1?e.replace(/[\\\/]/g,"[\\\\\\/]"):"\\"+e}).replace(/^(\\\/){2,}/g,"^([a-zA-Z]:)?[\\/\\\\]?(.+[\\/\\\\])?").replace(/(\\\/){2,}/g,"([\\/\\\\].+[\\/\\\\]|[\\/\\\\])").replace(/\*/g,"[^\\/\\\\\\*\\?]*")+"$","im")).fromString=e,i(u));case"regex-source":return isNull(e)&&t&&(e=t.defaultValue),isKindOf(e,RegExp)?i(e):isNull(e)?i(null):((u=new RegExp(e+"",n)).fromString=e,i(u));case"function":return i(isKindOf(e,Function)?e:isNull(e)?t&&t.hasOwnProperty("defaultValue")?isKindOf(t.defaultValue,Function)?t.defaultValue:function(){return t.defaultValue}:function(){return e}:function(){return e});case"array":s=null;if(isNull(e)&&t&&(e=t.defaultValue),isKindOf(e,String))if(t&&t.stringDelimiter)if(isArrayLike(t.stringDelimiter)){var u=new RegExp("("+t.stringDelimiter.map(function(e){return(e+"").replace(/[\$\^\*\(\)\-\+\[\]\{\}\\\|\,\?\/\.]/g,function(e){return"\\"+e})}).join(")|(")+")");s=e.split(u).filter(function(e){return!isNull(e)&&!u.test(e)})}else s=e.split(t.stringDelimiter);else t&&t.autowrapAsArray&&(s=[e]);else isArrayLike(e)?s=copyAsArray(e):t&&t.autowrapAsArray&&(s=[e]);if(s){if(t&&t.autotrim&&(s=s.map(function(e){return isKindOf(e,String)?e.trim():e})),t&&t.ignoreEmptyElement&&(s=s.filter(function(e){return!!e})),t&&t.uniqueElement){l=[];s.forEach(function(e){-1===l.indexOf(e)&&l.push(e)}),s=l}}else s=[];return i(s);case"array-autoindex":isNull(e)&&t&&(e=t.defaultValue);var s=[];if(e&&Object.keys(e).forEach(function(r){s.push(e[r])}),t&&t.autotrim&&(s=s.map(function(e){return isKindOf(e,String)?e.trim():e})),t&&t.ignoreEmptyElement&&(s=s.filter(function(e){return!!e})),t&&t.uniqueElement){var l=[];s.forEach(function(e){-1===l.indexOf(e)&&l.push(e)}),s=l}return i(s);case"object":if(isNull(e)&&t&&(e=t.defaultValue),isNull(e)||isKindOf(e,Boolean)||isKindOf(e,Number)||isKindOf(e,String)||isKindOf(e,RegExp)||isKindOf(e,Date))return i({});var o={};return iterateObject(e,function(e,r){o[e]=r}),i(o);default:return i(isKindOf(r,Function)?isKindOf(e,r)?e:new r(e):e)}},merge=function(){var e=copyAsArray(arguments);return e.unshift({}),advancedMerge.apply(this,e)},simpleMerge=function(){var e={};return copyAsArray(arguments).forEach(function(r){isKindOf(r,Object)&&Object.keys(r).forEach(function(t){e[t]=r[t]})}),e},advancedMerge=function(e){var r=null;e&&e["!noLogger"]?r={warn:function(e){}}:(Logger||(Logger=require("./logger.js")),r=new Logger);var t=null;return copyAsArray(arguments).slice(1).forEach(function(n){var i=function(e,t,n,a,u){if(n||(n={}),a){var s={};Object.keys(a).forEach(function(e){s[e]=a[e]}),a=s}else a={};if(u){var l={};Object.keys(a).forEach(function(e){l[e]=u[e]}),u=l}else u={};n["!templateData"]&&Object.keys(n["!templateData"]).forEach(function(e){a[e]=n["!templateData"][e]}),n["!templateFunctors"]&&Object.keys(n["!templateFunctors"]).forEach(function(e){u[e]=n["!templateFunctors"][e]}),n["!warningMessage"]&&r.warn(n["!warningMessage"]);var o="unknown",c=function(e,r){if(o=r,n[e]){var i={};n[e].split(/[\s,]+/g).forEach(function(e){i[e]=t}),t=i}},f=function(e){if(n["!postscript"]){var r={};return Object.keys(a).forEach(function(e){r[e]=a[e]}),r.data=e,template.execute(n["!postscript"],r,{functors:u})}return e};if(isNull(t)||isKindOf(t,Symbol))n["!nullOperation"]?operation=n["!nullOperation"]:operation="omit",o="null";else if(isKindOf(t,Boolean))c("!booleanFields","boolean");else if(isKindOf(t,Number))c("!numberFields","number");else if(isKindOf(t,String))c("!stringFields","string");else if(isKindOf(t,Buffer))c("!bufferFields","buffer");else if(isKindOf(t,Date))c("!dateFields","date");else if(isKindOf(t,RegExp))c("!regexFields","regex");else if(isKindOf(t,Function)&&n["!functionField"])c("!functionFields","function");else if(Array.isArray(t))if(n["!arrayFields"]){var p={};n["!arrayFields"].split(/[\s,]+/g).forEach(function(e){p[e]=t}),t=p}else n["!arrayOperation"]&&(operation=n["!arrayOperation"]),o="array";else o="object";var d={stringDelimiter:n["!stringDelimiter"],autowrapAsArray:!0,autotrim:n["!autotrimString"],ignoreEmptyElement:n["!ignoreEmptyElement"],defaultValue:n["!defaultValue"],numberAsInteger:n["!numberAsInteger"],validator:n["!validator"]};if(n.hasOwnProperty("!failedValue")&&(d.failedValue=n["!failedValue"]),t=convert(t,n["!valueType"],d),isNull(t)||"null"===o)return f("overwrite"===n["!nullOperation"]?isNull(n["!defaultValue"])?null:i(null,n["!defaultValue"],n,a,u):isNull(e)&&!isNull(n["!defaultValue"])?i(null,n["!defaultValue"],n,a,u):e);var g=n["!valueType"];g&&0===g.indexOf("regex")&&(g="regex");var m=function(r){return isNull(e)?isNull(n["!defaultValue"])?t:r(convert(n["!defaultValue"],n["!valueType"]),t):r(e,t)};switch(g){case"boolean":switch(n["!operation"]){case"and":return f(m(function(e,r){return e&&r}));case"or":return f(m(function(e,r){return e||r}));case"overwrite":default:return f(t)}case"number":switch(n["!operation"]){case"plus":return f(m(function(e,r){return e+r}));case"multiply":return f(m(function(e,r){return e*r}));case"and":return f(m(function(e,r){return e&r}));case"or":return f(m(function(e,r){return e|r}));case"xor":return f(m(function(e,r){return e^r}));case"min":return f(m(function(e,r){return Math.min(e,r)}));case"max":return f(m(function(e,r){return Math.max(e,r)}));case"overwrite":default:return f(t)}case"string":switch(n["!operation"]){case"plus":case"concat":return f(m(function(e,r){return isNull(n["!stringDelimiter"])?e+r:e&&r?e+n["!stringDelimiter"]+r:e+r}));case"overwrite":default:return f(t)}case"buffer":switch(n["!operation"]){case"concat":return f(m(function(e,r){return Buffer.concat([e,r])}));case"overwrite":default:return f(t)}case"date":switch(n["!operation"]){case"min":return f(m(function(e,r){return e.getTime()<r.getTime()?e:r}));case"max":return f(m(function(e,r){return e.getTime()>r.getTime()?e:r}));case"overwrite":default:return f(t)}case"regex":return f(t);case"function":var h=function(e,r,t){return function(){if(e){var n=e.apply(this,arguments);return r?t(n,r.apply(this,arguments)):t(n)}return r?t(r.apply(this,arguments)):t()}},y=function(r){return isNull(e)?isNull(n["!defaultValue"])?t:h(t,convert(n["!defaultValue"],n["!valueType"]),r):h(t,convert(e,n["!valueType"]),r)};switch(n["!operation"]){case"multicall":return f(y(function(){}));case"plus":return f(y(function(){var e=0;return copyAsArray(arguments).forEach(function(r){e+=r}),e}));case"multiply":return f(y(function(){var e=1;return copyAsArray(arguments).forEach(function(r){e*=r}),e}));case"and":return f(y(function(){var e=1;return copyAsArray(arguments).forEach(function(r){e=e&&r}),e}));case"or":return f(y(function(){var e=0;return copyAsArray(arguments).forEach(function(r){e=e||r}),e}));case"min":return f(y(function(){return Math.min.apply(Math,arguments)}));case"max":return f(y(function(){return Math.max.apply(Math,arguments)}));case"concat":return f(y(function(){var e=[];return copyAsArray(arguments).forEach(function(r){e.push(i(null,r,n["!resultVariant"],a,u))}),e}));case"union":return f(y(function(){var e=[];return copyAsArray(arguments).forEach(function(r){-1===e.indexOf(r)&&e.push(i(null,r,n["!resultVariant"],a,u))}),e}));case"merge":return f(y(function(){var e=copyAsArray(arguments);return e.unshift(n["!resultVariant"]),advancedMerge.call(this,e)}));case"overwrite":default:return f(t)}case"array":case"array-autoindex":switch(n["!operation"]){case"concat":b=[];return iterateArray(e,function(e){b.push(i(null,e,n["!arrayElement"],a,u))}),iterateArray(t,function(e){b.push(i(null,e,n["!arrayElement"],a,u))}),f(b);case"union":b=[];return iterateArray(e,function(e){e=i(null,e,n["!arrayElement"],a,u);var r=getIndex(b,n["!comparatorPath"],n["!comparatorType"],getProperty(e,n["!comparatorPath"]));-1===r?b.push(e):b[r]=i(b[r],e,n["!arrayElement"],a,u)}),iterateArray(t,function(e){e=i(null,e,n["!arrayElement"],a,u);var r=getIndex(b,n["!comparatorPath"],n["!comparatorType"],getProperty(e,n["!comparatorPath"]));-1===r?b.push(e):b[r]=i(b[r],e,n["!arrayElement"],a,u)}),f(b);case"overwrite":return f(t.slice(0));case"merge":default:b=[];return iterateArray(e,function(e,r){b[r]=i(null,e,n["!arrayElement"],a,u)}),iterateArray(t,function(e,r){b[r]=i(b[r],e,n["!arrayElement"],a,u)}),f(b)}case"object":default:var O=function(e,t,s){for(;n[t]&&n[t]["!aliasField"];){var l=n[t]["!aliasField"];n[t]["!aliasDeprecated"]&&r.warn('Field "'+t+'" is deprecated, please use field "'+l+'"'),s=i(e[t],s,n[t],a,u),t=l}n[t]?e[t]=i(e[t],s,n[t],a,u):n["!objectProperty"]?e[t]=i(e[t],s,n["!objectProperty"],a,u):n["!objectElement"]?(r.warn('Template definition "!objectElement" is deprecated for adavanced merge, please use "!objectProperty"'),e[t]=i(e[t],s,n["!objectElement"],a,u)):e[t]=i(e[t],s,null,a,u)};if(isKindOf(t,Boolean)||isKindOf(t,Number)||isKindOf(t,String)||isKindOf(t,Buffer)||isKindOf(t,Date)||isKindOf(t,RegExp)||isKindOf(t,Function)||isKindOf(t,Error)||isKindOf(t,Symbol)||isNull(e)||isKindOf(e,Boolean)||isKindOf(e,Number)||isKindOf(e,String)||isKindOf(e,Date)||isKindOf(e,Function)||isKindOf(e,Error)||isKindOf(e,Symbol)||isKindOf(e,RegExp)){if(isKindOf(t,Boolean)||isKindOf(t,Number)||isKindOf(t,String)||isKindOf(t,Buffer)||isKindOf(t,Date)||isKindOf(t,RegExp)||isKindOf(t,Function)||isKindOf(t,Error)||isKindOf(t,Symbol))return f(t);if("assign"===n["!operation"]||t&&t.constructor!==Object)return iterateObject(n,function(e,r){"!"!==e[0]&&!isNull(r)&&n[e].hasOwnProperty("!defaultValue")&&O(t,e,null)}),f(t);b=isKindOf(t,Array)&&!g?[]:{};return iterateObject(t,function(e,r){O(b,e,r)}),iterateObject(n,function(e,r){"!"!==e[0]&&!isNull(r)&&n[e].hasOwnProperty("!defaultValue")&&isNull(b[e])&&O(b,e,null)}),f(b)}switch(n["!operation"]){case"assign":return iterateObject(n,function(e,r){"!"!==e[0]&&!isNull(r)&&n[e].hasOwnProperty("!defaultValue")&&isNull(b[e])&&O(t,e,null)}),f(t);case"overwrite":b=isKindOf(t,Array)&&!g?[]:{};return iterateObject(t,function(e,r){O(b,e,r)}),iterateObject(n,function(e,r){"!"!==e[0]&&!isNull(r)&&n[e].hasOwnProperty("!defaultValue")&&isNull(b[e])&&O(b,e,null)}),f(b);case"merge":default:var b=t;return t.constructor===Object&&(b=isKindOf(t,Array)&&!g?[]:{}),iterateObject(e,function(e,r){O(b,e,r)}),b!==t&&iterateObject(t,function(e,r){O(b,e,r)}),iterateObject(n,function(e,r){"!"!==e[0]&&!isNull(r)&&n[e].hasOwnProperty("!defaultValue")&&isNull(b[e])&&O(b,e,null)}),f(b)}}};t=i(t,n,e,{},{})}),t},matchArguments=function(e,r,t){var n={};iterateObject(r,function(e,r){n[e]=advancedMerge({"!noLogger":!0,"!stringFields":"acceptTypes","!arrayFields":"acceptTypes",mergeAlias:{"!valueType":"string"},acceptTypes:{"!valueType":"array-autoindex","!stringFields":"type","!defaultValue":["any"]},mergeOptions:{"!valueType":"object"},defaultValue:null},r)});var i=null;if(iterateObject(e,function(e,r){if(r.length===t.length){for(var a={},u=!1,s=0;s<r.length;){var l=n[r[s]],o=!1;l.acceptTypes.forEach(function(e){o||(o=couldBeAcceptedAs(t[s],e))}),o?l.mergeOptions?a[r[s]]=advancedMerge(l.mergeOptions,t[s]):a[r[s]]=t[s]:u=!0,++s}u||(i=a)}}),i)return iterateObject(n,function(e,r){if(!i.hasOwnProperty(e)){var t=advancedMerge(r.mergeOptions,r.defaultValue);i[e]=t}}),Object.keys(i).slice(0).forEach(function(e){if(n[e]&&n[e].mergeAlias){var r={},t=null;n[e].mergeAlias.split(".").forEach(function(n,a,u){0===a&&(t=n),a<u.length-1?(r[n]={},r=r[n]):r[n]=i[e]}),i[t]=advancedMerge(n[t].mergeOptions,i[t],r),t!==e&&delete i[e]}}),i;throw new Error("Invalid arguments to match with settings")},getProperty=function(e,r){return r=convert(r,"string"),isNull(r)&&(r=""),(r=r.replace(/[\.\s]+/g,".")).length>0&&"."!==r&&r.split(".").forEach(function(r){e=isNull(e)?null:e[r]}),e},getIndex=function(e,r,t,n){r=convert(r,"string"),isNull(r)&&(r="");for(var i=comparator.generatePathComparator(r,t,!0),a=0;a<e.length;){if(0===i(e[a],n))return a;++a}return-1},keys=function(e){var r=[];for(var t in e)-1===r.indexOf(t)&&r.push(t);return r.sort(comparator.insensitiveNaturalComparator)},notEmpty=function(e){var r=simplify(e);return null===r||void 0===r||""===r?null:e},serializers=new Map,serializableObjects=new WeakMap,registerSerializer=function(e,r){serializers.set(e,r)},setSerialier=function(e,r){serializableObjects.set(e,r)},serialize=function(e){if(null===e||void 0===e)return"null";if(isKindOf(e,Boolean))return e?"true":"false";if(isKindOf(e,Number))return e+"";if(isKindOf(e,String))return'"'+e.replace(/\\/gim,"\\\\").replace(/\n/gim,"\\n").replace(/\r/gim,"\\r").replace(/"/gim,'\\"')+'"';if(isKindOf(e,Function))return"undefined";if(isKindOf(e,Array)){if(e.length>0){for(var r=["["],t=0;t<e.length;){var n=e[t];r.push(serialize(n)),t<e.length-1&&r.push(","),++t}return r.push("]"),r.join("")}return"[]"}r=["{"];return Object.keys(e).filter(function(r){return!isKindOf(e[r],Function)}).sort(comparator.insensitiveNaturalComparator).forEach(function(t,n,i){r.push(serialize(t)),r.push(":"),r.push(serialize(e[t])),n<i.length-1&&r.push(",")}),r.push("}"),r.join("")},deserialize=function(e){return JSON.parse(e)};module.exports={deprecated:deprecated,getScriptEngineName:getScriptEngineName,objectize:objectize,isNull:isNull,isKindOf:isKindOf,isArrayLike:isArrayLike,copyAsArray:copyAsArray,iterate:iterate,iterateArray:iterateArray,iterateObject:iterateObject,formatDate:formatDate,notEmpty:notEmpty,couldBeAcceptedAs:couldBeAcceptedAs,simplify:simplify,convert:convert,merge:merge,simpleMerge:simpleMerge,advancedMerge:advancedMerge,prepadZero:prepadZero,getStack:getStack,jsonize:jsonize,matchArguments:matchArguments,getProperty:getProperty,getIndex:getIndex,keys:keys,serialize:serialize,deserialize:deserialize,isAccelerated:isAccelerated};