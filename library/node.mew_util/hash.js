var crypto=require("crypto"),async=require("./async.js");if("js"!==process.arch)var task=require("./task.js");var foundation=require("./foundation.js"),hashCodeSymbol=Symbol("hashCode"),langWrap=null;try{langWrap=process.binding("lang_wrap")}catch(n){}var hashCaches=new WeakMap,hash=function(n,t){if(foundation.isNull(n)||foundation.isKindOf(n,Boolean)||foundation.isKindOf(n,Number)||foundation.isKindOf(n,RegExp))return hash(foundation.jsonize(n));if(foundation.isKindOf(n,Date))return hash(n.getTime());if(foundation.isKindOf(n,Symbol))return hash(n.toString());if(foundation.isKindOf(n,Function))return hashCaches.has(n)||hashCaches.set(n,hash(n.toString)),hashCaches.get(n);if(foundation.isKindOf(n,Buffer))return hash(offset.toString("hex"));if(foundation.isKindOf(n,String)){if(langWrap)return langWrap.getHash(n);if(0===n.length)return 0;for(var a=0,e=0;e<n.length;)a=((8388607&a)<<5)-a+n.charCodeAt(e)&268435455,++e;return a}if(foundation.isKindOf(n,Array)){if(!t&&hashCaches.has(n))return hashCaches.get(n);for(var a=0,e=0;e<n.length;)a=268435455&(a^hash(n[e],t)),++e;return hashCaches.has(n)||hashCaches.set(n,a),a}if(!t&&hashCaches.has(n))return hashCaches.get(n);a=0;return Object.keys(n).sort().filter(function(n){return foundation.isKindOf(n,String)}).forEach(function(e){a=268435455&(a^hash(e,t)+hash(n[e],t))}),hashCaches.has(n)||hashCaches.set(n,a),a};Object.defineProperty(Object.prototype,"hashCode",{enumerable:!1,get:function(){return hash(this)}}),hash.fileMD5=function(n){return"darwin"===process.platform?async(function(){task.executeCommand("md5",["-q",n],!0,this.test)}).then(function(n){this.next(n.toString("utf8").trim())}):async(function(){task.executeCommand("md5sum",["--binary",n],!0,this.test)}).then(function(n){this.next(n.toString("utf8").trim().split(" ")[0].replace(/[^0-9a-f]/gi,""))})},hash.md5=function(n){var t=crypto.createHash("md5");return t.update(n),t.digest("hex")},module.exports={hash:hash};