$(function(){var e=require("util"),t=Symbol("gestureRecognizers"),n=function(e){return-1!==[r.BEGAN,r.CHANGING].indexOf(e)},o=function(e){return-1!==[r.RECOGNIZING,r.BEGAN,r.CHANGING].indexOf(e)},a=function(e){return-1!==[r.ENDED,r.CANCELED].indexOf(e)},i=function(e){var t=e.split(".");return t[t.length-1]=c(e),t.join(".")},c=function(e){var t=e.split(".").slice(-1)[0],n=null;return Object.keys($.dom.gestureRecognizers).forEach(function(e){0===t.indexOf("gesture:"+e+"-")&&(!n||n.length<e.length)&&(n=e)}),n||t},r=function(e,n){n||(n=""),this.id=$.uuid(),this.element=e,this.domain=n,e.hasOwnProperty(t)||(e[t]=[]),e[t].push(this)};r.RECOGNIZING="recognizing",r.BEGAN="began",r.CHANGING="changing",r.ENDED="ended",r.CANCELED="canceled",r.prototype.type="unknown",r.prototype.state=r.ENDED,r.prototype.addElementListener=function(e,n){var a=this;$(this.element).on(this.id+"."+e,function(e,i){for(var c=[],r=!1,s=e.target;s&&!r;){if(s===a.element&&(r=!0),s.hasOwnProperty(t))for(var l=!1,d=0;d<s[t].length&&!l;)a===s[t][d]?l=!0:c.push(s[t][d]),++d;s=s.parentNode}if(0===c.filter(function(e){return!!o(e.state)&&!e.isRecognizerAllowed(a)}).length){e.availableRecoginzers||(e.availableRecoginzers=c,e.availableRecoginzers.unshift(a));let t=e.availableRecoginzers.indexOf(a);-1!==t&&(e.availableRecoginzers.splice(0,t),e.availableRecoginzers.slice(1).forEach(function(t){if(!a.isRecognizerAllowed(t,!0)){let n=e.availableRecoginzers.indexOf(t);-1!==n&&e.availableRecoginzers.splice(n,1)}})),-1!==e.availableRecoginzers.indexOf(a)&&n.apply(this,arguments)}})},r.prototype.on=function(e,t){var n=this;$(this.element).on(e,function(e,o){o.recognizer===n&&t.apply(this,arguments)})},r.prototype.detach=function(){$(this.element).off(this.id+".*")},r.prototype.isRecognizerAllowed=function(e,t){return this.state===r.RECOGNIZING||!(!this.delegate||!this.delegate.isOtherRecognizerAllowed)&&this.delegate.isOtherRecognizerAllowed(this,otherRecognizer)};var s=function(e,t){r.call(this,e,t);var i=this,c=0,s="unknown",l=null,d=null,u=null,g=null,p=0,h=0,I=0,m=0,f=0,P=0,E=0;this.addElementListener(this.id+".mouse:pressed",function(t,n){if("main"===n.pressed&&(!l||"mouse"===l)&&-1!==i.inputs.indexOf("mouse")&&!(i.pointers[0]>1||1>=i.pointers[1])&&a(i.state)){var o=++p;(h=Date.now())-I<i.interval&&"mouse"===s?++E:E=0,s="mouse",l="mouse",c=0,m=1,f=1,d=n.locationInPage,u=n.locationInScreen,g=$(e).positionFromPage(n.locationInPage),i.state=r.RECOGNIZING,$.delay(i.delay,function(){o===p&&i.state===r.RECOGNIZING&&(c<=i.radius?(i.state=r.BEGAN,$(e).addFeatures("tapping"),$.command.dispatch(e,"gesture:tap-began",{target:e,input:"mouse",pointers:m,recognizer:i,accumulatedTaps:E,locationInPage:d,locationInScreen:u,locationInTarget:g})):(++p,i.state=r.CANCELED,l=null))})}}),this.addElementListener(this.id+".mouse:dragging",function(t,n){if("main"===n.button&&(!l||"mouse"===l)&&-1!==i.inputs.indexOf("mouse")&&!(i.pointers[0]>1||1>=i.pointers[1])&&o(i.state)){if(u){var a=n.locationInScreen.x-u.x,r=n.locationInScreen.y-u.y;c+=Math.sqrt(a*a+r*r)}m=1,d=n.locationInPage,u=n.locationInScreen,g=$(e).positionFromPage(n.locationInPage)}}),this.addElementListener(this.id+".mouse:dropped",function(t,a){if("main"===a.button&&(!l||"mouse"===l)&&-1!==i.inputs.indexOf("mouse")&&!(i.pointers[0]>1||1>=i.pointers[1])&&o(i.state)){m=1,I=Date.now();var s=$(e).positionFromPage(a.locationInPage),d=$(e).size();if(s.x>=0&&s.x<d.width&&s.y>=0&&s.y<d.height){i.state===r.RECOGNIZING&&c<=i.radius&&(i.state=r.BEGAN,$(e).addFeatures("tapping"),$.command.dispatch(e,"gesture:tap-began",{target:e,input:"mouse",pointers:m,recognizer:i,accumulatedTaps:E,locationInPage:a.locationInPage,locationInScreen:a.locationInScreen,locationInTarget:$(e).positionFromPage(a.locationInPage)})),i.state=r.ENDED,$.delay(100,function(){i.state===r.ENDED&&$(e).removeFeatures("tapping")}),$.command.dispatch(e,"gesture:tap-ended",{target:e,input:"mouse",pointers:m,recognizer:i,accumulatedTaps:E,locationInPage:a.locationInPage,locationInScreen:a.locationInScreen,locationInTarget:$(e).positionFromPage(a.locationInPage)});var u=++p;$.delay(i.interval,function(){u===p&&$.command.dispatch(e,"gesture:tap-accumulated",{target:e,input:"mouse",pointers:m,recognizer:i,accumulatedTaps:E+1,locationInPage:a.locationInPage,locationInScreen:a.locationInScreen,locationInTarget:$(e).positionFromPage(a.locationInPage)})}),l=null}else n(i.state)?(i.state=r.CANCELED,$.delay(100,function(){i.state===r.CANCELED&&$(e).removeFeatures("tapping")}),$.command.dispatch(e,"gesture:tap-canceled",{target:e,input:"mouse",pointers:m,recognizer:i,accumulatedTaps:E,locationInPage:a.locationInPage,locationInScreen:a.locationInScreen,locationInTarget:$(e).positionFromPage(a.locationInPage)})):i.state=r.CANCELED,E>0&&$.command.dispatch(e,"gesture:tap-accumulated",{target:e,input:"mouse",pointers:m,recognizer:i,accumulatedTaps:E,locationInPage:a.locationInPage,locationInScreen:a.locationInScreen,locationInTarget:$(e).positionFromPage(a.locationInPage)}),E=0,l=null,++p}}),this.addElementListener(this.id+".touch:started",function(t,n){if((!l||"touch"===l)&&-1!==i.inputs.indexOf("touch")&&a(i.state)){var o=++p;(h=Date.now())-I<i.interval&&"touch"===s?++E:E=0,P=0,s="touch",l="touch",m=0,f=0,c=0,d=n.locationInPage,u=n.locationInScreen,g=$(e).positionFromPage(n.locationInPage),i.state=r.RECOGNIZING,$.delay(i.delay,function(){o===p&&(i.state=r.RECOGNIZING)&&i.pointers[0]<=m&&m<i.pointers[1]&&(c<=i.radius?(i.state=r.BEGAN,$(e).addFeatures("tapping"),$.command.dispatch(e,"gesture:tap-began",{target:e,input:"touch",pointers:m,recognizer:i,accumulatedTaps:E,locationInPage:d,locationInScreen:u,locationInTarget:g})):(++p,i.state=r.CANCELED,l=null))})}}),this.addElementListener(this.id+".touch:added",function(t,a){l&&"touch"!==l||-1!==i.inputs.indexOf("touch")&&o(i.state)&&(++m>f&&(f=m),m>=i.pointers[1]&&(++p,i.state=r.CANCELED,l=null,n(i.state)&&($.delay(100,function(){i.state===r.CANCELED&&$(e).removeFeatures("tapping")}),$.command.dispatch(e,"gesture:tap-canceled",{target:e,input:"touch",pointers:m,recognizer:i,accumulatedTaps:E,locationInPage:a.locationInPage,locationInScreen:a.locationInScreen,locationInTarget:$(e).positionFromPage(a.locationInPage)}),E>0&&$.command.dispatch(e,"gesture:tap-accumulated",{target:e,input:"touch",pointers:m,recognizer:i,accumulatedTaps:E,locationInPage:a.locationInPage,locationInScreen:a.locationInScreen,locationInTarget:$(e).positionFromPage(a.locationInPage)}))))}),this.addElementListener(this.id+".touch:moved",function(t,n){if((!l||"touch"===l)&&-1!==i.inputs.indexOf("touch")&&o(i.state)){if(u){var a=n.locationInScreen.x-u.x,r=n.locationInScreen.y-u.y;c+=Math.sqrt(a*a+r*r)}d=n.locationInPage,u=n.locationInScreen,g=$(e).positionFromPage(n.locationInPage)}}),this.addElementListener(this.id+".touch:removed",function(e,t){l&&"touch"!==l||-1!==i.inputs.indexOf("touch")&&o(i.state)&&(--m,P||(P=Date.now()))}),this.addElementListener(this.id+".touch:ended",function(t,a){if((!l||"touch"===l)&&-1!==i.inputs.indexOf("touch")&&o(i.state)){I=Date.now();var s=$(e).positionFromPage(a.locationInPage);if(s.x>=-i.shelf&&s.x<e.clientWidth+i.shelf&&s.y>=-i.shelf&&s.y<e.clientHeight+i.shelf&&Date.now()-P<i.release&&i.pointers[0]<=f&&f<i.pointers[1]){i.state===r.RECOGNIZING&&c<=i.radius&&(i.state=r.BEGAN,$(e).addFeatures("tapping"),$.command.dispatch(e,"gesture:tap-began",{target:e,input:"touch",pointers:m,recognizer:i,accumulatedTaps:E,locationInPage:a.locationInPage,locationInScreen:a.locationInScreen,locationInTarget:$(e).positionFromPage(a.locationInPage)})),i.state=r.ENDED,$.delay(100,function(){i.state===r.ENDED&&$(e).removeFeatures("tapping")}),$.command.dispatch(e,"gesture:tap-ended",{target:e,input:"touch",pointers:m,recognizer:i,accumulatedTaps:E,locationInPage:a.locationInPage,locationInScreen:a.locationInScreen,locationInTarget:$(e).positionFromPage(a.locationInPage)});var d=++p;$.delay(i.interval,function(){d===p&&$.command.dispatch(e,"gesture:tap-accumulated",{target:e,input:"touch",pointers:m,recognizer:i,accumulatedTaps:E+1,locationInPage:a.locationInPage,locationInScreen:a.locationInScreen,locationInTarget:$(e).positionFromPage(a.locationInPage)})}),l=null}else n(i.state)?(i.state=r.CANCELED,$.delay(100,function(){i.state===r.CANCELED&&$(e).removeFeatures("tapping")}),$.command.dispatch(e,"gesture:tap-canceled",{target:e,input:"touch",pointers:m,recognizer:i,accumulatedTaps:E,locationInPage:a.locationInPage,locationInScreen:a.locationInScreen,locationInTarget:$(e).positionFromPage(a.locationInPage)})):i.state=r.CANCELED,E>0&&$.command.dispatch(e,"gesture:tap-accumulated",{target:e,input:"touch",pointers:m,recognizer:i,accumulatedTaps:E,locationInPage:a.locationInPage,locationInScreen:a.locationInScreen,locationInTarget:$(e).positionFromPage(a.locationInPage)}),E=0,l=null,++p}}),this.addElementListener(this.id+".touch:interrupted",function(e,t){l&&"touch"!==l||-1!==i.inputs.indexOf("touch")&&o(i.state)&&(--m,P||(P=Date.now()))}),this.addElementListener(this.id+".touch:canceled",function(t,n){l&&"touch"!==l||-1!==i.inputs.indexOf("touch")&&o(i.state)&&(++p,i.state=r.CANCELED,l=null,$.delay(100,function(){i.state===r.CANCELED&&$(e).removeFeatures("tapping")}),$.command.dispatch(e,"gesture:tap-canceled",{target:e,input:"touch",pointers:m,recognizer:i,accumulatedTaps:E,locationInPage:n.locationInPage,locationInScreen:n.locationInScreen,locationInTarget:$(e).positionFromPage(n.locationInPage)}),E>0&&$.command.dispatch(e,"gesture:tap-accumulated",{target:e,input:"touch",pointers:m,recognizer:i,accumulatedTaps:E,locationInPage:n.locationInPage,locationInScreen:n.locationInScreen,locationInTarget:$(e).positionFromPage(n.locationInPage)}))})};e.inherits(s,r),s.prototype.type="tap",s.prototype.radius=3,s.prototype.delay=100,s.prototype.interval=300,s.prototype.release=300,s.prototype.shelf=20,s.prototype.inputs=["mouse","touch"],s.prototype.pointers=[1,1/0];var l=function(e,t){r.call(this,e,t);var o=this,a=0,i=0,c=0,s=0,l=null,d=0,u={x:0,y:0},g={};this.addElementListener(this.id+".mouse:pressed",function(e,t){++a,i=0,c=1,s=0,o.state=r.RECOGNIZING,u={x:0,y:0},g={mouse:{locationInScreen:t.locationInScreen}},d=Date.now(),l=t.locationInScreen}),this.addElementListener(this.id+".mouse:dragging",function(t,a){var s=g.mouse;if(u.x+=a.locationInScreen.x-s.locationInScreen.x,u.y+=a.locationInScreen.y-s.locationInScreen.y,n(o.state)&&$.command.dispatch(e,"gesture:pan-moved",{target:e,pointers:c,recognizer:o,translation:u,locationInPage:a.locationInPage,locationInScreen:a.locationInScreen,locationInTarget:$(e).positionFromPage(a.locationInPage)}),l){var p=a.locationInScreen.x-l.x,h=a.locationInScreen.y-l.y;i+=Math.sqrt(p*p+h*h)}o.state===r.RECOGNIZING&&Date.now()-d>o.delay&&i>o.radius&&o.pointers[0]<=c&&c<o.pointers[1]&&(o.state=r.BEGAN,$.command.dispatch(e,"gesture:pan-began",{target:e,pointers:c,recognizer:o,translation:u,locationInPage:a.locationInPage,locationInScreen:a.locationInScreen,locationInTarget:$(e).positionFromPage(a.locationInPage)})),l=a.locationInScreen,g.mouse.locationInScreen=a.locationInScreen}),this.addElementListener(this.id+".mouse:dropped",function(t,l){o.state===r.RECOGNIZING&&Date.now()-d<=o.delay&&o.pointers[0]<=s&&s<o.pointers[1]&&i>=o.radius&&(o.state=r.BEGAN,$.command.dispatch(e,"gesture:pan-began",{target:e,pointers:c,recognizer:o,translation:u,locationInPage:l.locationInPage,locationInScreen:l.locationInScreen,locationInTarget:$(e).positionFromPage(l.locationInPage)}),o.state=r.CHANGING,$.command.dispatch(e,"gesture:pan-moved",{target:e,pointers:c,recognizer:o,translation:u,locationInPage:l.locationInPage,locationInScreen:l.locationInScreen,locationInTarget:$(e).positionFromPage(l.locationInPage)})),n(o.state)?(o.state=r.ENDED,$.command.dispatch(e,"gesture:pan-ended",{target:e,pointers:c,recognizer:o,translation:u,locationInPage:l.locationInPage,locationInScreen:l.locationInScreen,locationInTarget:$(e).positionFromPage(l.locationInPage)}),++a):(o.state=r.CANCELED,++a)}),this.addElementListener(this.id+".touch:started",function(e,t){++a,i=0,c=0,s=0,o.state=r.RECOGNIZING,u={x:0,y:0},g={},d=Date.now(),l=t.locationInScreen}),this.addElementListener(this.id+".touch:added",function(e,t){++c,s=Math.max(c,s),g={},t.touches.forEach(function(e){g[e.identifier]=e}),l=t.locationInScreen}),this.addElementListener(this.id+".touch:moved",function(t,a){if(o.pointers[0]<=c&&c<o.pointers[1]){switch(a.touches.length){case 0:break;case 1:if(g.hasOwnProperty(a.touches[0].identifier)){var s=g[a.touches[0].identifier];u.x+=a.touches[0].locationInScreen.x-s.locationInScreen.x,u.y+=a.touches[0].locationInScreen.y-s.locationInScreen.y}break;case 2:var p=0,h=0,I=0,m=0;a.touches.forEach(function(e){if(g.hasOwnProperty(e.identifier)){var t=e.locationInScreen.x-g[e.identifier].locationInScreen.x,n=e.locationInScreen.y-g[e.identifier].locationInScreen.y;t<0?p=Math.min(t,p):t>0&&(h=Math.max(t,h)),n<0?I=Math.min(n,I):n>0&&(m=Math.max(n,m))}}),u.x+=p+h,u.y+=I+m;break;default:var f=0,P=0;a.touches.forEach(function(e){g.hasOwnProperty(e.identifier)&&(f+=e.locationInScreen.x-g[e.identifier].locationInScreen.x,P+=e.locationInScreen.y-g[e.identifier].locationInScreen.y)}),u.x+=f,u.y+=P}n(o.state)&&$.command.dispatch(e,"gesture:pan-moved",{target:e,pointers:c,recognizer:o,translation:u,locationInPage:a.locationInPage,locationInScreen:a.locationInScreen,locationInTarget:$(e).positionFromPage(a.locationInPage)})}if(l){var f=a.locationInScreen.x-l.x,P=a.locationInScreen.y-l.y;i+=Math.sqrt(f*f+P*P)}o.state===r.RECOGNIZING&&Date.now()-d>o.delay&&i>o.radius&&o.pointers[0]<=c&&c<o.pointers[1]&&(o.state=r.BEGAN,$.command.dispatch(e,"gesture:pan-began",{target:e,pointers:c,recognizer:o,translation:u,locationInPage:a.locationInPage,locationInScreen:a.locationInScreen,locationInTarget:$(e).positionFromPage(a.locationInPage)})),l=a.locationInScreen,g={},a.touches.forEach(function(e){g[e.identifier]=e})}),this.addElementListener(this.id+".touch:removed",function(e,t){--c,g={},t.touches.forEach(function(e){g[e.identifier]=e}),l=t.locationInScreen}),this.addElementListener(this.id+".touch:ended",function(t,l){o.state===r.RECOGNIZING&&Date.now()-d<=o.delay&&o.pointers[0]<=s&&s<o.pointers[1]&&i>=o.radius&&(o.state=r.BEGAN,$.command.dispatch(e,"gesture:pan-began",{target:e,pointers:c,recognizer:o,translation:u,locationInPage:l.locationInPage,locationInScreen:l.locationInScreen,locationInTarget:$(e).positionFromPage(l.locationInPage)}),o.state=r.CHANGING,$.command.dispatch(e,"gesture:pan-moved",{target:e,pointers:c,recognizer:o,translation:u,locationInPage:l.locationInPage,locationInScreen:l.locationInScreen,locationInTarget:$(e).positionFromPage(l.locationInPage)})),n(o.state)?(o.state=r.ENDED,$.command.dispatch(e,"gesture:pan-ended",{target:e,pointers:c,recognizer:o,translation:u,locationInPage:l.locationInPage,locationInScreen:l.locationInScreen,locationInTarget:$(e).positionFromPage(l.locationInPage)}),++a):(o.state=r.CANCELED,++a)}),this.addElementListener(this.id+".touch:interrupted",function(e,t){--c,g={},t.touches.forEach(function(e){g[e.identifier]=e}),l=t.locationInScreen}),this.addElementListener(this.id+".touch:canceled",function(t,i){n(o.state)?(o.state=r.CANCELED,$.command.dispatch(e,"gesture:pan-canceled",{target:e,pointers:c,recognizer:o,translation:u,locationInPage:i.locationInPage,locationInScreen:i.locationInScreen,locationInTarget:$(e).positionFromPage(i.locationInPage)}),++a):(o.state=r.CANCELED,++a)})};e.inherits(l,r),l.prototype.type="pan",l.prototype.radius=3,l.prototype.delay=100,l.prototype.pointers=[1,1/0];var d=function(e,t){r.call(this,e,t);var o=this,a=0,i=1,c=0,s=function(e){var t={x:0,y:0};return e.touches.forEach(function(e){t.x+=e.locationInScreen.x,t.y+=e.locationInScreen.y}),t={x:t.x/e.touches.length,y:t.y/e.touches.length},touchesDistance=0,e.touches.forEach(function(e){var n={x:e.locationInScreen.x-t.x,y:e.locationInScreen.y-t.y};touchesDistance+=Math.sqrt(n.x*n.x+n.y*n.y)}),touchesDistance/e.touches.length};this.addElementListener(this.id+".touch:started",function(e,t){++a,i=1,c=0,o.state=r.RECOGNIZING}),this.addElementListener(this.id+".touch:added",function(e,t){c=s(t)}),this.addElementListener(this.id+".touch:moved",function(t,n){if(n.touches.length>1){o.state===r.RECOGNIZING&&(o.state=r.BEGAN,$.command.dispatch(e,"gesture:pinch-began",{target:e,recognizer:o,scale:i,locationInPage:n.locationInPage,locationInScreen:n.locationInScreen,locationInTarget:$(e).positionFromPage(n.locationInPage)}));var a=s(n);0!==a&&0!==c&&a!==c&&(i*=a/c,$.command.dispatch(e,"gesture:pinch-changed",{target:e,recognizer:o,scale:i,locationInPage:n.locationInPage,locationInScreen:n.locationInScreen,locationInTarget:$(e).positionFromPage(n.locationInPage)}),c=a)}else c=s(n)}),this.addElementListener(this.id+".touch:removed",function(e,t){c=s(t)}),this.addElementListener(this.id+".touch:ended",function(t,c){n(o.state)?(o.state=r.ENDED,$.command.dispatch(e,"gesture:pinch-ended",{target:e,recognizer:o,scale:i,locationInPage:c.locationInPage,locationInScreen:c.locationInScreen,locationInTarget:$(e).positionFromPage(c.locationInPage)}),++a):(o.state=r.CANCELED,++a)}),this.addElementListener(this.id+".touch:interrupted",function(e,t){c=s(t)}),this.addElementListener(this.id+".touch:canceled",function(t,c){n(o.state)?(o.state=r.CANCELED,$.command.dispatch(e,"gesture:pinch-canceled",{target:e,recognizer:o,scale:i,locationInPage:c.locationInPage,locationInScreen:c.locationInScreen,locationInTarget:$(e).positionFromPage(c.locationInPage)}),++a):(o.state=r.CANCELED,++a)})};e.inherits(d,r),d.prototype.type="pinch";var u=function(e,t){r.call(this,e,t);var o=this,a=0,i=0,c={},s=function(e){var t={x:0,y:0};return e.forEach(function(e){t.x+=e.locationInScreen.x,t.y+=e.locationInScreen.y}),t={x:t.x/e.length,y:t.y/e.length}},l=function(e){var t=s(c),n=s(e),o=0,a=0;return e.forEach(function(e){var i=c.filter(function(t){return t.identifier===e.identifier})[0];if(i){++a;for(var r=Math.atan2(e.locationInScreen.y-n.y,e.locationInScreen.x-n.x)-Math.atan2(i.locationInScreen.y-t.y,i.locationInScreen.x-t.x);r>Math.PI;)r-=2*Math.PI;for(;r<-Math.PI;)r+=2*Math.PI;o+=r}}),0===a?0:o/a};this.addElementListener(this.id+".touch:started",function(e,t){++a,i=0,c={},o.state=r.RECOGNIZING}),this.addElementListener(this.id+".touch:added",function(e,t){c=t.touches.slice(0)}),this.addElementListener(this.id+".touch:moved",function(t,n){if(n.touches.length>1){o.state===r.RECOGNIZING&&(o.state=r.BEGAN,$.command.dispatch(e,"gesture:rotation-began",{target:e,recognizer:o,rotation:i,locationInPage:n.locationInPage,locationInScreen:n.locationInScreen,locationInTarget:$(e).positionFromPage(n.locationInPage)}));var a=l(n.touches);0!==a&&(i+=a,$.command.dispatch(e,"gesture:rotation-changed",{target:e,recognizer:o,rotation:i,locationInPage:n.locationInPage,locationInScreen:n.locationInScreen,locationInTarget:$(e).positionFromPage(n.locationInPage)}),c=n.touches.slice(0))}else c=n.touches.slice(0)}),this.addElementListener(this.id+".touch:removed",function(e,t){c=t.touches.slice(0)}),this.addElementListener(this.id+".touch:ended",function(t,c){n(o.state)?(o.state=r.ENDED,$.command.dispatch(e,"gesture:rotation-ended",{target:e,recognizer:o,rotation:i,locationInPage:c.locationInPage,locationInScreen:c.locationInScreen,locationInTarget:$(e).positionFromPage(c.locationInPage)}),++a):(o.state=r.CANCELED,++a)}),this.addElementListener(this.id+".touch:interrupted",function(e,t){c=t.touches.slice(0)}),this.addElementListener(this.id+".touch:canceled",function(t,c){n(o.state)?(o.state=r.CANCELED,$.command.dispatch(e,"gesture:rotation-canceled",{target:e,recognizer:o,rotation:i,locationInPage:c.locationInPage,locationInScreen:c.locationInScreen,locationInTarget:$(e).positionFromPage(c.locationInPage)}),++a):(o.state=r.CANCELED,++a)})};e.inherits(u,r),u.prototype.type="rotate";var g=function(e,t){r.call(this,e,t);var o=this,a=0,i=0,c=0,s=0,l=null,d=0,u={x:0,y:0},g={};this.addElementListener(this.id+".touch:started",function(t,n){if(isFinite(o.edge)){var p=!1,h=$(e).positionFromPage(n.locationInPage);if((h.x<o.edge||h.x>=e.clientWidth-o.edge)&&(h.y<o.edge||h.y>=e.clientHeight-o.edge)&&(p=!0),!p)return}++a,i=0,c=0,s=0,o.state=r.RECOGNIZING,u={x:0,y:0},g={},d=Date.now(),l=n.locationInScreen;var I=a;$.delay(o.delay,function(){o.state===r.RECOGNIZING&&I===a&&(i<=o.radius||o.pointers[0]>s||s>=o.pointers[1])&&(o.state=r.CANCELED,++a)})}),this.addElementListener(this.id+".touch:added",function(e,t){++c,s=Math.max(c,s),g={},t.touches.forEach(function(e){g[e.identifier]=e}),l=t.locationInScreen}),this.addElementListener(this.id+".touch:moved",function(t,n){if(o.pointers[0]<=c&&c<o.pointers[1])switch(n.touches.length){case 0:break;case 1:if(g.hasOwnProperty(n.touches[0].identifier)){var p=g[n.touches[0].identifier];u.x+=n.touches[0].locationInScreen.x-p.locationInScreen.x,u.y+=n.touches[0].locationInScreen.y-p.locationInScreen.y}break;case 2:var h=0,I=0,m=0,f=0;n.touches.forEach(function(e){if(g.hasOwnProperty(e.identifier)){var t=e.locationInScreen.x-g[e.identifier].locationInScreen.x,n=e.locationInScreen.y-g[e.identifier].locationInScreen.y;t<0?h=Math.min(t,h):t>0&&(I=Math.max(t,I)),n<0?m=Math.min(n,m):n>0&&(f=Math.max(n,f))}}),u.x+=h+I,u.y+=m+f;break;default:var P=0,E=0;n.touches.forEach(function(e){g.hasOwnProperty(e.identifier)&&(P+=e.locationInScreen.x-g[e.identifier].locationInScreen.x,E+=e.locationInScreen.y-g[e.identifier].locationInScreen.y)}),u.x+=P,u.y+=E}if(l){var P=n.locationInScreen.x-l.x,E=n.locationInScreen.y-l.y;i+=Math.sqrt(P*P+E*E)}if(l=n.locationInScreen,o.state===r.RECOGNIZING&&Date.now()-d>o.delay&&i>o.radius&&o.pointers[0]<=s&&s<o.pointers[1])if(Math.abs(u.x)+Math.abs(u.y)>0){var S="unknown";S=Math.abs(u.x)>Math.abs(u.y)?u.x>0?"from-left":"from-right":u.y>0?"from-top":"from-bottom",-1!==o.directions.indexOf(S)?(o.state=r.BEGAN,$.command.dispatch(e,"gesture:swipe-began",{target:e,pointers:s,recognizer:o,direction:"unknown",locationInPage:n.locationInPage,locationInScreen:n.locationInScreen,locationInTarget:$(e).positionFromPage(n.locationInPage)}),o.state=r.ENDED,$.command.dispatch(e,"gesture:swipe-ended",{target:e,pointers:s,recognizer:o,direction:S,locationInPage:n.locationInPage,locationInScreen:n.locationInScreen,locationInTarget:$(e).positionFromPage(n.locationInPage)})):o.state=r.CANCELED,++a}else o.state=r.CANCELED,++a;g={},n.touches.forEach(function(e){g[e.identifier]=e})}),this.addElementListener(this.id+".touch:removed",function(e,t){--c,g={},t.touches.forEach(function(e){g[e.identifier]=e}),l=t.locationInScreen}),this.addElementListener(this.id+".touch:ended",function(t,c){var l="unknown";l=Math.abs(u.x)>Math.abs(u.y)?u.x>0?"from-left":"from-right":u.y>0?"from-top":"from-bottom",o.state===r.RECOGNIZING&&Date.now()-d<=o.delay&&o.pointers[0]<=s&&s<o.pointers[1]&&i>=o.radius&&-1!==o.directions.indexOf(l)&&(Math.abs(u.x)+Math.abs(u.y)>0?(o.state=r.BEGAN,$.command.dispatch(e,"gesture:swipe-began",{target:e,pointers:s,recognizer:o,direction:l,locationInPage:c.locationInPage,locationInScreen:c.locationInScreen,locationInTarget:$(e).positionFromPage(c.locationInPage)})):(o.state=r.CANCELED,++a)),n(o.state)?(-1!==o.directions.indexOf(l)?(o.state=r.ENDED,$.command.dispatch(e,"gesture:swipe-ended",{target:e,pointers:s,recognizer:o,direction:l,locationInPage:c.locationInPage,locationInScreen:c.locationInScreen,locationInTarget:$(e).positionFromPage(c.locationInPage)})):(o.state=r.CANCELED,$.command.dispatch(e,"gesture:swipe-canceled",{target:e,pointers:s,recognizer:o,direction:l,locationInPage:c.locationInPage,locationInScreen:c.locationInScreen,locationInTarget:$(e).positionFromPage(c.locationInPage)})),++a):(o.state=r.CANCELED,++a)}),this.addElementListener(this.id+".touch:interrupted",function(e,t){--c,g={},t.touches.forEach(function(e){g[e.identifier]=e}),l=t.locationInScreen}),this.addElementListener(this.id+".touch:canceled",function(t,i){n(o.state)?(o.state=r.CANCELED,$.command.dispatch(e,"gesture:swipe-canceled",{target:e,pointers:c,recognizer:o,locationInPage:i.locationInPage,locationInScreen:i.locationInScreen,locationInTarget:$(e).positionFromPage(i.locationInPage)}),++a):(o.state=r.CANCELED,++a)})};e.inherits(g,r),g.prototype.type="swipe",g.prototype.radius=50,g.prototype.delay=200,g.prototype.pointers=[1,1/0],g.prototype.directions=["from-left","from-right","from-top","from-bottom"],g.prototype.edge=1/0;var p=function(e,t){r.call(this,e,t);var i=this,c=0,s="unknown",l=null,d=null,u=null,g=null,p=0,h=0;this.addElementListener(this.id+".mouse:pressed",function(t,n){if("main"===n.pressed&&(!l||"mouse"===l)&&-1!==i.inputs.indexOf("mouse")&&!(i.pointers[0]>1||1>=i.pointers[1])&&a(i.state)){var o=++p;s="mouse",l="mouse",c=0,h=1,d=n.locationInPage,u=n.locationInScreen,g=$(e).positionFromPage(n.locationInPage),i.state=r.RECOGNIZING,$.delay(i.delay,function(){if(o===p&&i.state===r.RECOGNIZING){var t=$(e).positionFromPage(d);c<=i.radius&&t.x>=0&&t.y>=0&&t.x<e.clientWidth&&t.y<e.clientHeight?(i.state=r.BEGAN,$.command.dispatch(e,"gesture:hold-began",{target:e,input:"mouse",pointers:h,recognizer:i,locationInPage:d,locationInScreen:u,locationInTarget:g}),i.state=r.ENDED,$.command.dispatch(e,"gesture:hold-ended",{target:e,input:"mouse",pointers:h,recognizer:i,locationInPage:d,locationInScreen:u,locationInTarget:g}),++p,l=null):(++p,i.state=r.CANCELED,l=null)}})}}),this.addElementListener(this.id+".mouse:dragging",function(t,n){if("main"===n.button&&(!l||"mouse"===l)&&-1!==i.inputs.indexOf("mouse")&&!(i.pointers[0]>1||1>=i.pointers[1])&&o(i.state)){if(u){var a=n.locationInScreen.x-u.x,r=n.locationInScreen.y-u.y;c+=Math.sqrt(a*a+r*r)}h=1,d=n.locationInPage,u=n.locationInScreen,g=$(e).positionFromPage(n.locationInPage)}}),this.addElementListener(this.id+".mouse:dropped",function(t,a){"main"===a.button&&(l&&"mouse"!==l||-1!==i.inputs.indexOf("mouse")&&(i.pointers[0]>1||1>=i.pointers[1]||o(i.state)&&(h=1,n(i.state)?(i.state=r.CANCELED,$.command.dispatch(e,"gesture:hold-canceled",{target:e,input:"mouse",pointers:h,recognizer:i,locationInPage:a.locationInPage,locationInScreen:a.locationInScreen,locationInTarget:$(e).positionFromPage(a.locationInPage)})):i.state=r.CANCELED,l=null,++p)))}),this.addElementListener(this.id+".touch:started",function(t,n){if((!l||"touch"===l)&&-1!==i.inputs.indexOf("touch")&&a(i.state)){var o=++p;s="touch",l="touch",c=0,h=0,d=n.locationInPage,u=n.locationInScreen,g=$(e).positionFromPage(n.locationInPage),i.state=r.RECOGNIZING,$.delay(i.delay,function(){if(o===p&&(i.state=r.RECOGNIZING)){var t=$(e).positionFromPage(d);i.pointers[0]<=h&&h<i.pointers[1]&&c<=i.radius&&t.x>=-i.shelf&&t.y>=-i.shelf&&t.x<e.clientWidth+i.shelf&&t.y<e.clientHeight+i.shelf?(i.state=r.BEGAN,$.command.dispatch(e,"gesture:hold-began",{target:e,input:"touch",pointers:h,recognizer:i,locationInPage:d,locationInScreen:u,locationInTarget:g}),i.state=r.ENDED,$.command.dispatch(e,"gesture:hold-ended",{target:e,input:"touch",pointers:h,recognizer:i,locationInPage:d,locationInScreen:u,locationInTarget:g})):(++p,i.state=r.CANCELED,l=null)}})}}),this.addElementListener(this.id+".touch:added",function(t,a){l&&"touch"!==l||-1!==i.inputs.indexOf("touch")&&o(i.state)&&++h>=i.pointers[1]&&(++p,i.state=r.CANCELED,l=null,n(i.state)&&$.command.dispatch(e,"gesture:hold-canceled",{target:e,input:"touch",pointers:h,recognizer:i,accumulatedTaps:accumulatedTaps,locationInPage:a.locationInPage,locationInScreen:a.locationInScreen,locationInTarget:$(e).positionFromPage(a.locationInPage)}))}),this.addElementListener(this.id+".touch:moved",function(t,n){if((!l||"touch"===l)&&-1!==i.inputs.indexOf("touch")&&o(i.state)){if(u){var a=n.locationInScreen.x-u.x,r=n.locationInScreen.y-u.y;c+=Math.sqrt(a*a+r*r)}d=n.locationInPage,u=n.locationInScreen,g=$(e).positionFromPage(n.locationInPage)}}),this.addElementListener(this.id+".touch:removed",function(e,t){l&&"touch"!==l||-1!==i.inputs.indexOf("touch")&&o(i.state)&&--h}),this.addElementListener(this.id+".touch:ended",function(t,a){l&&"touch"!==l||-1!==i.inputs.indexOf("touch")&&o(i.state)&&(n(i.state)?(i.state=r.CANCELED,$.command.dispatch(e,"gesture:hold-canceled",{target:e,input:"touch",pointers:h,recognizer:i,locationInPage:a.locationInPage,locationInScreen:a.locationInScreen,locationInTarget:$(e).positionFromPage(a.locationInPage)})):i.state=r.CANCELED,l=null,++p)}),this.addElementListener(this.id+".touch:interrupted",function(e,t){l&&"touch"!==l||-1!==i.inputs.indexOf("touch")&&o(i.state)&&(--h,firstRemovePointerDate||(firstRemovePointerDate=Date.now()))}),this.addElementListener(this.id+".touch:canceled",function(t,n){l&&"touch"!==l||-1!==i.inputs.indexOf("touch")&&o(i.state)&&(++p,i.state=r.CANCELED,l=null,$.command.dispatch(e,"gesture:hold-canceled",{target:e,input:"touch",pointers:h,recognizer:i,locationInPage:n.locationInPage,locationInScreen:n.locationInScreen,locationInTarget:$(e).positionFromPage(n.locationInPage)}))})};e.inherits(p,r),p.prototype.type="hold",p.prototype.radius=5,p.prototype.delay=800,p.prototype.inputs=["mouse","touch"],p.prototype.pointers=[1,1/0],p.prototype.shelf=20,$.dom.upgradeEventListener("*",function(e,n,o,a){var r=o,s=e.split(".").slice(-1)[0].split(":");if(s.length>1&&"gesture"===s[0]){var l=i(e),d=[];n.hasOwnProperty(t)&&(d=n[t].filter(function(e){return e.domain===l}));var u=d[0];if(!u){var g=c(e);u=new $.dom.gestureRecognizers[g](n,l),a&&a.hasOwnProperty("gestureDelegate")&&(u.delegate=a.gestureDelegate);var p=function(t){var n=e.split(".").filter(function(e){return 0===e.indexOf(t+"-")||e===t})[0];return n?n===t?t:n.slice(t.length+1):null};switch(g){case"tap":switch(p("inputs")){case"mouse":u.inputs=["mouse"];break;case"touch":u.inputs=["touch"]}I=parseInt(p("min-pointers"));isNaN(I)&&(I=1);m=parseInt(p("max-pointers"));isNaN(m)&&(m=1/0),u.pointers=[I,m];break;case"hold":switch(p("inputs")){case"mouse":u.inputs=["mouse"];break;case"touch":u.inputs=["touch"]}I=parseInt(p("min-pointers"));isNaN(I)&&(I=1);m=parseInt(p("max-pointers"));isNaN(m)&&(m=1/0),u.pointers=[I,m];var h=parseInt(p("delay"));isFinite(h)&&(u.delay=h);break;case"pan":I=parseInt(p("min-pointers"));isNaN(I)&&(I=1);m=parseInt(p("max-pointers"));isNaN(m)&&(m=1/0),u.pointers=[I,m];break;case"swipe":var I=parseInt(p("min-pointers"));isNaN(I)&&(I=1);var m=parseInt(p("max-pointers"));isNaN(m)&&(m=1/0);var f=[];u.pointers=[I,m],p("from-left")&&f.push("from-left"),p("from-right")&&f.push("from-right"),p("from-top")&&f.push("from-top"),p("from-bottom")&&f.push("from-bottom"),f.length>0&&(u.directions=f);var P=parseInt(p("edge"));isFinite(P)&&(u.edge=P)}}r=function(e){e.parameters[0].recognizer===u&&o.apply(this,arguments)}}return r}),$.dom.gestureRecognizers={unknown:r,tap:s,pan:l,pinch:d,rotation:u,swipe:g,hold:p}});