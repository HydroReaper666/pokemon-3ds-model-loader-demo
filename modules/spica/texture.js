(()=>{const t=require("./section.js"),e=[0,1,8,9,2,3,10,11,16,17,24,25,18,19,26,27,4,5,12,13,6,7,14,15,20,21,28,29,22,23,30,31,32,33,40,41,34,35,42,43,48,49,56,57,50,51,58,59,36,37,44,45,38,39,46,47,52,53,60,61,54,55,62,63],r=function(e){if(this.magic=e.readUint32(),1!==e.readUint32())throw new Error("Invalid texture version, expected 1");const r=new t(e,"texture");let n=e.index;const o=e.readUint32();e.skip(12,0),this.name=e.readString(64),this.width=e.readUint16(),this.height=e.readUint16(),this.format=e.readUint16(),this.mipmapSize=e.readUint16(),e.skip(16,255);const i=e.index;for(this.data=[];e.index<i+o;)this.data.push(e.readUint8());for(;e.index<n+r.length;)if(0!==e.readUint8())throw new Error("Invalid padding, expected 0")};r.readers={},r.RGB565=2,r.readers[r.RGB565]=function(t,r,n,o,i){let a=0,l=0;for(;l<o/8;){let r=0;for(;r<n/8;){let o=0;for(;o<64;){let f=e[o]%8,h=4*(8*r+f+(8*l+(e[o]-f)/8)*n),s=t[a]|t[a+1]<<8,d=(s>>11&31)<<3,u=(s>>5&63)<<2,c=(31&s)<<3;i[h]=255,i[h+1]=d|d>>5,i[h+2]=u|u>>6,i[h+3]=c|c>>5,a+=2,++o}++r}++l}},r.RGB8=3,r.readers[r.RGB8]=function(t,r,n,o,i){let a=0,l=0;for(;l<o/8;){let r=0;for(;r<n/8;){let o=0;for(;o<64;){let f=e[o]%8,h=4*(8*r+f+(8*l+(e[o]-f)/8)*n);i[h]=255,i[h+1]=t[a+2],i[h+2]=t[a+1],i[h+3]=t[a],a+=3,++o}++r}++l}},r.RGBA8=4,r.readers[r.RGBA8]=function(t,r,n,o,i){let a=0,l=0;for(;l<o/8;){let r=0;for(;r<n/8;){let o=0;for(;o<64;){let f=e[o]%8,h=4*(8*r+f+(8*l+(e[o]-f)/8)*n);i[h]=t[a],i[h+1]=t[a+3],i[h+2]=t[a+2],i[h+3]=t[a+1],a+=4,++o}++r}++l}},r.RGBA4=22,r.readers[r.RGBA4]=function(t,r,n,o,i){let a=0,l=0;for(;l<o/8;){let r=0;for(;r<n/8;){let o=0;for(;o<64;){let f=e[o]%8,h=4*(8*r+f+(8*l+(e[o]-f)/8)*n),s=65535&(t[a]|t[a+1]<<8),d=s>>12&15,u=s>>8&15,c=s>>4&15,m=15&s;i[h]=m|m<<4,i[h+1]=d|d<<4,i[h+2]=u|u<<4,i[h+3]=c|c<<4,a+=2,++o}++r}++l}},r.RGBA5551=23,r.LA8=35,r.readers[r.LA8]=function(t,r,n,o,i){let a=0,l=0;for(;l<o/8;){let r=0;for(;r<n/8;){let o=0;for(;o<64;){let f=e[o]%8,h=4*(8*r+f+(8*l+(e[o]-f)/8)*n);i[h]=t[a],i[h+1]=t[a+1],i[h+2]=t[a+1],i[h+3]=t[a+1],a+=2,++o}++r}++l}},r.HILO8=36,r.readers[r.HILO8]=r.readers[r.L8],r.L8=37,r.readers[r.L8]=function(t,r,n,o,i){let a=0,l=0;for(;l<o/8;){let r=0;for(;r<n/8;){let o=0;for(;o<64;){let f=e[o]%8,h=4*(8*r+f+(8*l+(e[o]-f)/8)*n);i[h]=255,i[h+1]=t[a],i[h+2]=t[a],i[h+3]=t[a],++a,++o}++r}++l}},r.A8=38,r.LA4=39,r.readers[r.LA4]=function(t,r,n,o,i){let a=0,l=0;for(;l<o/8;){let r=0;for(;r<n/8;){let o=0;for(;o<64;){let f=e[o]%8,h=4*(8*r+f+(8*l+(e[o]-f)/8)*n),s=15&t[a],d=t[a]>>4;i[h]=s<<4|s,i[h+1]=d<<4|d,i[h+2]=d<<4|d,i[h+3]=d<<4|d,++a,++o}++r}++l}},r.L4=40,r.readers[r.L4]=function(t,r,n,o,i){let a=0,l=!1,f=0;for(;f<o/8;){let r=0;for(;r<n/8;){let o=0;for(;o<64;){let h=e[o]%8,s=4*(8*r+h+(8*f+(e[o]-h)/8)*n),d=l?(240&t[a++])>>4:15&t[a];l=!l,d|=d<<4,i[s]=255,i[s+1]=d,i[s+2]=d,i[s+3]=d,++o}++r}++f}},r.A4=41,r.ETC1=42,r.readers[r.ETC1]=function(t,e,r,n,o){const i=[[-8,-2,2,8],[-17,-5,5,17],[-29,-9,9,29],[-42,-13,13,42],[-60,-18,18,60],[-80,-24,24,80],[-106,-33,33,106],[-183,-47,47,183]],a=function(t,e,r,n,o,a,l){let f=i[l][a[n]>>2*o&3];return[Math.min(Math.max(r+f,0),255),Math.min(Math.max(e+f,0),255),Math.min(Math.max(t+f,0),255)]},l=function(t){return t>127?t-256:t},f=[0,4,0,4],h=[0,0,4,4];let s=0,d=0;for(;d<n;){let e=0;for(;e<r;){let n=0;for(;n<4;){let i=function(e){let r,n,o,i,f,h,s=e,d=e+2,u=e+4,c=e+5,m=e+6,g=e+7,p=0!=(1&t[u]),x=0!=(2&t[u]),M=t[u]>>4&7,w=t[u]>>2&7,A=[t[s+1],t[s],t[d+1],t[d]],L=t[g],U=t[m],R=t[c];x?(o=248&R,o|=o>>5,n=248&U,n|=n>>5,r=248&L,r|=r>>5,h=(h=(R>>3)+(l((7&R)<<5)>>5))<<3|h>>2,f=(f=(U>>3)+(l((7&U)<<5)>>5))<<3|f>>2,i=(i=(L>>3)+(l((7&L)<<5)>>5))<<3|i>>2):(o=240&R,o|=o>>4,n=240&U,n|=n>>4,r=240&L,r|=r>>4,h=(15&R)<<4,h|=h>>4,f=(15&U)<<4,f|=f>>4,i=(15&L)<<4,i|=i>>4);let I=[];if(p){let t=0;for(;t<2;){let e=0;for(;e<4;){let l=a(r,n,o,e,t+0,A,M),s=4*(4*t+e);I[s+0]=l[2],I[s+1]=l[1],I[s+2]=l[0],I[s+3]=Math.round((l[2]+l[1]+l[0])/3),I[s+3]<68&&(I[s+3]=0);let d=a(i,f,h,e,t+2,A,w),u=4*(4*(t+2)+e);I[u+0]=d[2],I[u+1]=d[1],I[u+2]=d[0],I[u+3]=Math.round((d[2]+d[1]+d[0])/3),I[u+3]<68&&(I[u+3]=0),++e}++t}}else{let t=0;for(;t<4;){let e=0;for(;e<2;){let l=a(r,n,o,e+0,t,A,M),s=4*(4*t+e);I[s+0]=l[2],I[s+1]=l[1],I[s+2]=l[0],I[s+3]=Math.round((l[2]+l[1]+l[0])/3),I[s+3]<68&&(I[s+3]=0);let d=a(i,f,h,e+2,t,A,w),u=4*(4*t+e+2);I[u+0]=d[2],I[u+1]=d[1],I[u+2]=d[0],I[u+3]=Math.round((d[2]+d[1]+d[0])/3),I[u+3]<68&&(I[u+3]=0),++e}++t}}return I}(s);s+=8;let u=0,c=h[n];for(;c<4+h[n];){let t=f[n];for(;t<4+f[n];){let n=4*((d+c)*r+e+t);o[n+0]=i[u+3],o[n+1]=i[u+0],o[n+2]=i[u+1],o[n+3]=i[u+2],u+=4,++t}++c}++n}e+=8}d+=8}},r.ETC1A4=43,r.readers[r.ETC1A4]=function(t,e,r,n,o){const i=[[-8,-2,2,8],[-17,-5,5,17],[-29,-9,9,29],[-42,-13,13,42],[-60,-18,18,60],[-80,-24,24,80],[-106,-33,33,106],[-183,-47,47,183]],a=function(t,e,r,n,o,a,l){let f=i[l][a[n]>>2*o&3];return[Math.min(Math.max(r+f,0),255),Math.min(Math.max(e+f,0),255),Math.min(Math.max(t+f,0),255)]},l=function(e,r,n){let o=t[e+(r<<1)+(n>>1)]>>4*(1&n)&15;return o|o<<4},f=function(t){return t>127?t-256:t},h=[0,4,0,4],s=[0,0,4,4];let d=0,u=0;for(;u<n;){let e=0;for(;e<r;){let n=0;for(;n<4;){let i=function(e){let r,n,o,i,h,s,d=e+8,u=e+10,c=e+12,m=e+13,g=e+14,p=e+15,x=0!=(1&t[c]),M=0!=(2&t[c]),w=t[c]>>4&7,A=t[c]>>2&7,L=[t[d],t[d+1],t[u],t[u+1]],U=t[p],R=t[g],I=t[m];M?(o=248&I,o|=o>>5,n=248&R,n|=n>>5,r=248&U,r|=r>>5,s=(s=(I>>3)+(f((7&I)<<5)>>5))<<3|s>>2,h=(h=(R>>3)+(f((7&R)<<5)>>5))<<3|h>>2,i=(i=(U>>3)+(f((7&U)<<5)>>5))<<3|i>>2):(o=240&I,o|=o>>4,n=240&R,n|=n>>4,r=240&U,r|=r>>4,s=(15&I)<<4,s|=s>>4,h=(15&R)<<4,h|=h>>4,i=(15&U)<<4,i|=i>>4);let B=[];if(x){let t=0;for(;t<2;){let f=0;for(;f<4;){let d=a(r,n,o,f,t+0,L,w),u=4*(4*t+f);B[u+0]=d[2],B[u+1]=d[1],B[u+2]=d[0],B[u+3]=l(e,f,t+0);let c=a(i,h,s,f,t+2,L,A),m=4*(4*(t+2)+f);B[m+0]=c[2],B[m+1]=c[1],B[m+2]=c[0],B[m+3]=l(e,f,t+2),++f}++t}}else{let t=0;for(;t<4;){let f=0;for(;f<2;){let d=a(r,n,o,f+0,t,L,w),u=4*(4*t+f);B[u+0]=d[2],B[u+1]=d[1],B[u+2]=d[0],B[u+3]=l(e,f+0,t);let c=a(i,h,s,f+2,t,L,A),m=4*(4*t+f+2);B[m+0]=c[2],B[m+1]=c[1],B[m+2]=c[0],B[m+3]=l(e,f+2,t),++f}++t}}return B}(d);d+=16;let c=0,m=s[n];for(;m<4+s[n];){let t=h[n];for(;t<4+h[n];){let n=4*((u+m)*r+e+t);o[n+0]=i[c+3],o[n+1]=i[c+0],o[n+2]=i[c+1],o[n+3]=i[c+2],c+=4,++t}++m}++n}e+=8}u+=8}},r.prototype.getPixels=function(){if(r.readers[this.format]){let t=new Uint8Array(this.width*this.height*4);return r.readers[this.format](this.data,this.format,this.width,this.height,t),t}throw new Error("Unsupported texture file format "+this.format)},r.prototype.toImage=function(){const t=new Image;return t.title=this.name,t.src=this.toImageURL(),t},r.prototype.toImageURL=function(){return this.toCanvas().toDataURL()},r.prototype.toCanvas=function(){var t=document.createElement("canvas");t.width=this.width,t.height=this.height,t.name=this.name;var e=t.getContext("2d"),r=e.createImageData(this.width,this.height);let n=this.getPixels(),o=0;for(;o<n.length;)r.data[o]=n[o+1],r.data[o+1]=n[o+2],r.data[o+2]=n[o+3],r.data[o+3]=n[o],o+=4;return e.putImageData(r,0,0),t},module.exports=r})(this.$);