(()=>{const t=["scaleX","scaleY","scaleZ","rotationX","rotationY","rotationZ","translationX","translationY","translationZ"],e=["scaleX","scaleY","rotation","translationX","translationY"],a=["r","g","b","a"],r=function t(e){const a=e.subreader();this.magic=e.readUint32();const r=e.readUint32(),i=[];let n=0;for(;n<r;)i.push({type:e.readUint32(),length:e.readUint32(),offset:e.readUint32()}),++n;i.forEach(e=>{let r=a.subreader(e.offset,e.length);switch(e.type){case 0:this.frames=r.readUint32(),this.flags=[r.readUint16(),r.readUint16()],this.loop=0!=(1&this.flags[0]),this.blended=0!=(1&this.flags[1]),this.animationRegion={min:[r.readFloat32(),r.readFloat32(),r.readFloat32()],max:[r.readFloat32(),r.readFloat32(),r.readFloat32()]},this.hash=r.readUint32();break;case 1:this.skeletal=new t.Skeletal(r,this.frames);break;case 3:this.material=new t.Material(r,this.frames);break;case 6:this.visibility=new t.Visibility(r,this.frames);break;case 5:this.constant=new t.Constant(r,this.frames);break;case 7:this.action=new t.Action(r,this.frames)}})};r.FPS=24,r.interpolate=function(t,e,a){if(!e)return t.value;if(t.frame===e.frame)return t.value;if(t.frame===a)return t.value;if(e.frame===a)return e.value;let r=a-t.frame,i=r/(e.frame-t.frame),n=t.value+(t.value-e.value)*(2*i-3)*i*i;return n+=r*(i-1)*(t.slope*(i-1)+e.slope*i)},r.readKeyFrames=function(t,e,a){let r=[],i=0!=(4&e),n=0!=(2&e),s=0!=(1&e);if(n&&i)throw new Error("Invalid axis");if(i){let e=t.readUint32(),i=[],n=0;for(;n<e;)a>255?i.push(t.readUint16()):i.push(t.readUint8()),++n;if(t.skipPadding(4,[0,255]),s){for(n=0;n<e;)r.push({frame:i[n],value:t.readFloat32(),slope:t.readFloat32()}),++n;r.isConstant=!1}else{let a=t.readFloat32(),s=t.readFloat32(),o=t.readFloat32(),l=t.readFloat32();for(n=0;n<e;){let e=t.readUint16(),d=t.readUint16();r.push({frame:i[n],value:e/65535*a+s,slope:d/65535*o+l}),++n}r.isConstant=!1}}else n?s?(r.isConstant=!0,r.push({frame:0,value:t.readFloat32(),slope:0})):(r.isConstant=!0,r.push({frame:0,value:1,slope:0})):s&&(r.isConstant=!0,r.push({frame:0,value:0,slope:0}));return r};r.Skeletal=function(t,e){const a=t.readInt32(),i=t.readUint32(),n=t.subreader(),s=[];let o=0;for(;o<a;)s.push(t.readString(t.readUint8())),++o;let l=n.subreader(i);this.transforms=s.map(t=>new r.BoneTransform(l,t,e))};r.BoneTransform=function(e,a,i){this.bone=a;let n=e.readUint32();const s=e.readUint32();let o=e.index;this.axisAngle=0==(n>>31&1),n&=2147483647;let l=0;for(;l<9;)this[t[l]]=r.readKeyFrames(e,7&n,i),n>>=3,++l;if(e.index-o!==s)throw new Error("Incorrect data length in skeletal motion")};r.Material=function(t,e){let a=t.readInt32(),i=t.readUint32(),n=[],s=0;for(;s<a;)n.push({count:t.readUint32()}),++s;let o=t.subreader();for(s=0;s<a;)n[s].material=t.readString(t.readUint8()),++s;let l=o.subreader(i);this.transforms=[],n.forEach(t=>{let a=0;for(;a<t.count;)this.transforms.push(new r.TextureTransform(l,t.material,e)),++a})};r.TextureTransform=function(t,a,i){this.material=a,this.textureIndex=t.readUint32();let n=t.readUint32();t.readUint32();let s=0;for(;s<5;)this[e[s]]=r.readKeyFrames(t,7&n,i),n>>=3,++s};r.Visibility=function(t,e){let a=t.readInt32(),i=t.readUint32(),n=t.subreader(),s=[],o=0;for(;o<a;)s[o]=t.readString(t.readUint8()),++o;let l=n.subreader(i);this.transforms=s.map(t=>new r.MeshTransform(l,t,e))};r.MeshTransform=function(t,e,a){this.mesh=e,this.visibility=[];let r=0,i=0;for(;i<=a;){let e=7&i;0===e&&(r=t.readUint8()),this.visibility.push({frame:i,value:0!=(r&1<<e),slope:0}),++i}this.visibility.isConstant=!1,0===this.visibility.filter(t=>t.value).length&&(this.visibility.isConstant=!0),0===this.visibility.filter(t=>!t.value).length&&(this.visibility.isConstant=!0)};r.Constant=function(t,e){let a=t.readInt32(),i=t.readUint32(),n=[],s=0;for(;s<a;)n.push({count:t.readUint32()}),++s;let o=t.subreader();n.forEach(e=>{e.mesh=t.readString(t.readUint8())});let l=o.subreader(i);for(this.values=[],n.forEach(t=>{let a=0;for(;a<t.count;)this.values.push(new r.ConstantChange(l,t.mesh,e)),++a}),this.post=[];l.index<l.end;)this.post.push(l.readUint8())};r.ConstantChange=function(t,e,i){this.material=e,this.constantIndex=t.readUint32();let n=t.readUint32();const s=t.readUint32();let o=t.index;n&=2147483647;let l=0;for(;l<4;)this[a[l]]=r.readKeyFrames(t,7&n,i),n>>=3,++l;if(t.index-o!==s)throw new Error("Incorrect data length in constant changes")};r.Action=function(t){},module.exports=r})(this.$);